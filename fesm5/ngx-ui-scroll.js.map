{"version":3,"file":"ngx-ui-scroll.js","sources":["../package/src/component/utils/checkDatasource.ts","../package/src/component/utils/assignSettings.ts","../package/src/component/interfaces/direction.ts","../package/src/component/interfaces/process.ts","../package/src/component/classes/adapter.ts","../package/src/component/classes/datasource.ts","../package/src/component/classes/settings.ts","../package/src/component/classes/logger.ts","../package/src/component/classes/domRoutines.ts","../package/src/component/classes/paddings.ts","../package/src/component/classes/viewport.ts","../package/src/component/classes/cache.ts","../package/src/component/classes/buffer.ts","../package/src/component/classes/fetch.ts","../package/src/component/classes/state.ts","../package/src/component/scroller.ts","../package/src/component/processes/init.ts","../package/src/component/processes/scroll.ts","../package/src/component/processes/reload.ts","../package/src/component/processes/start.ts","../package/src/component/processes/preFetch.ts","../package/src/component/processes/fetch.ts","../package/src/component/classes/item.ts","../package/src/component/processes/postFetch.ts","../package/src/component/processes/render.ts","../package/src/component/processes/adjust.ts","../package/src/component/processes/clip.ts","../package/src/component/processes/end.ts","../package/src/component/workflow.ts","../package/src/ui-scroll.component.ts","../package/src/ui-scroll.version.ts","../package/src/ui-scroll.directive.ts","../package/src/ui-scroll.module.ts"],"sourcesContent":["import { Datasource as IDatasource } from '../interfaces/index';\n\nexport const checkDatasource = (datasource: IDatasource) => {\n  if (!datasource) {\n    throw new Error('No datasource provided');\n  }\n  if (!('get' in datasource)) {\n    throw new Error('Datasource get method is not implemented');\n  }\n  if (typeof datasource.get !== 'function') {\n    throw new Error('Datasource get is not a function');\n  }\n  if ((<Function>(datasource.get)).length < 2) {\n    throw new Error('Datasource get method invalid signature');\n  }\n  return datasource;\n};\n","import { Settings as _ISettings, DevSettings as _IDevSettings } from '../interfaces/index';\r\nimport { Settings } from '../classes/settings';\r\n\r\ntype ISettings = _ISettings | _IDevSettings;\r\n\r\nconst assignBoolean = (\r\n  target: Settings, source: ISettings, token: string, defaults: ISettings\r\n) => {\r\n  const param = (<any>source)[token];\r\n  if (typeof param === 'undefined') {\r\n    return;\r\n  }\r\n  if (typeof param !== 'boolean') {\r\n    console.warn(token + ' setting parse error, set it to ' + (<any>defaults)[token] + ' (default)');\r\n    return;\r\n  }\r\n  (<any>target)[token] = param;\r\n  return true;\r\n};\r\n\r\nconst assignNumeric = (\r\n  target: Settings, source: ISettings, token: string, defaults: ISettings, integer = false\r\n) => {\r\n  const param = (<any>source)[token];\r\n  if (typeof param === 'undefined') {\r\n    return;\r\n  }\r\n  if (typeof param !== 'number') {\r\n    console.warn(token + ' setting parse error, set it to ' + (<any>defaults)[token] + ' (default)');\r\n    return;\r\n  }\r\n  if (integer && parseInt(param.toString(), 10) !== param) {\r\n    console.warn(token + ' setting parse error, set it to ' + (<any>defaults)[token] + ' (default)');\r\n    return;\r\n  }\r\n  (<any>target)[token] = param;\r\n  return true;\r\n};\r\n\r\nconst assignMinimalNumeric = (\r\n  target: Settings,\r\n  source: ISettings,\r\n  token: string,\r\n  defaults: ISettings,\r\n  minSettings: ISettings,\r\n  integer = false,\r\n  mustExist = true\r\n) => {\r\n  if (assignNumeric(target, source, token, defaults, integer) !== true) {\r\n    if (!mustExist) {\r\n      return;\r\n    }\r\n  }\r\n  if ((<any>target)[token] < (<any>minSettings)[token]) {\r\n    console.warn(token + ' setting is less than minimum, set it to ' + (<any>minSettings)[token]);\r\n    (<any>target)[token] = (<any>minSettings)[token];\r\n    return;\r\n  }\r\n  return true;\r\n};\r\n\r\nconst assignCommon = (target: Settings, settings: ISettings, defaults: ISettings) => {\r\n  Object.assign(target, defaults);\r\n  if (typeof settings === 'undefined') {\r\n    return;\r\n  }\r\n  if (typeof settings !== 'object') {\r\n    console.warn('settings is not an object, fallback to the defaults');\r\n    return;\r\n  }\r\n};\r\n\r\nexport const assignSettings = (\r\n  target: Settings, settings: _ISettings, defaults: _ISettings, minSettings: _ISettings\r\n) => {\r\n  assignCommon(target, settings, defaults);\r\n  assignBoolean(target, settings, 'adapter', defaults);\r\n  assignNumeric(target, settings, 'startIndex', defaults);\r\n  assignNumeric(target, settings, 'minIndex', defaults);\r\n  assignNumeric(target, settings, 'maxIndex', defaults);\r\n  assignMinimalNumeric(target, settings, 'itemSize', defaults, minSettings, true, false);\r\n  assignMinimalNumeric(target, settings, 'bufferSize', defaults, minSettings, true);\r\n  assignMinimalNumeric(target, settings, 'padding', defaults, minSettings);\r\n  assignBoolean(target, settings, 'infinite', defaults);\r\n  assignBoolean(target, settings, 'horizontal', defaults);\r\n  assignBoolean(target, settings, 'windowViewport', defaults);\r\n};\r\n\r\nexport const assignDevSettings = (\r\n  target: Settings, devSettings: _IDevSettings, defaults: _IDevSettings, minDevSettings: _IDevSettings\r\n) => {\r\n  assignCommon(target, devSettings, defaults);\r\n  assignBoolean(target, devSettings, 'debug', defaults);\r\n  assignBoolean(target, devSettings, 'immediateLog', defaults);\r\n  assignBoolean(target, devSettings, 'logTime', defaults);\r\n  assignMinimalNumeric(target, devSettings, 'throttle', defaults, minDevSettings, true);\r\n  assignBoolean(target, devSettings, 'inertia', defaults);\r\n  assignMinimalNumeric(target, devSettings, 'inertiaScrollDelay', defaults, minDevSettings, true);\r\n  assignMinimalNumeric(target, devSettings, 'inertiaScrollDelta', defaults, minDevSettings, true);\r\n  assignMinimalNumeric(target, devSettings, 'initDelay', defaults, minDevSettings, true);\r\n  assignMinimalNumeric(target, devSettings, 'initWindowDelay', defaults, minDevSettings, true);\r\n  assignMinimalNumeric(target, devSettings, 'maxSynthScrollDelay', defaults, minDevSettings, true);\r\n};\r\n","export enum Direction {\n  forward = 'forward',\n  backward = 'backward'\n}\n","export enum Process {\r\n  init = 'init',\r\n  scroll = 'scroll',\r\n  reload = 'reload',\r\n  start = 'start',\r\n  preFetch = 'preFetch',\r\n  fetch = 'fetch',\r\n  postFetch = 'postFetch',\r\n  render = 'render',\r\n  clip = 'clip',\r\n  adjust = 'adjust',\r\n  end = 'end'\r\n}\r\n\r\nexport enum ProcessStatus {\r\n  start = 'start',\r\n  next = 'next',\r\n  done = 'done',\r\n  error = 'error'\r\n}\r\n\r\nexport interface ScrollPayload {\r\n  event?: Event;\r\n  byTimer?: boolean;\r\n}\r\n\r\nexport interface ProcessRun {\r\n  empty?: boolean;\r\n  scroll?: boolean;\r\n  keepScroll?: boolean;\r\n  byTimer?: boolean;\r\n  error?: string;\r\n}\r\n\r\nexport interface ProcessSubject {\r\n  process: Process;\r\n  status: ProcessStatus;\r\n  payload?: ProcessRun;\r\n}\r\n\r\nexport type CallWorkflow = (processSubject: ProcessSubject) => undefined;\r\n","import { BehaviorSubject, Observable, Observer, of as observableOf } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\n\r\nimport { Adapter as IAdapter, Process, ProcessSubject, ProcessStatus, ItemAdapter } from '../interfaces/index';\r\nimport { Scroller } from '../scroller';\r\n\r\nconst getIsInitialized = (adapter: Adapter): Observable<boolean> =>\r\n  Observable.create((observer: Observer<boolean>) => {\r\n    const intervalId = setInterval(() => {\r\n      if (adapter && adapter.init) {\r\n        clearInterval(intervalId);\r\n        observer.next(true);\r\n        observer.complete();\r\n      }\r\n    }, 25);\r\n  });\r\n\r\nconst getInitializedSubject = (adapter: Adapter, method: Function): BehaviorSubject<any> => {\r\n  return adapter.init ? method() :\r\n    adapter.init$\r\n      .pipe(switchMap(() =>\r\n        method()\r\n      ));\r\n};\r\n\r\nexport const itemAdapterEmpty = <ItemAdapter> {\r\n  data: {},\r\n  element: {}\r\n};\r\n\r\nexport const generateMockAdapter = (): IAdapter => (\r\n  <IAdapter> {\r\n    version: null,\r\n    init: false,\r\n    init$: observableOf(false),\r\n    isLoading: false,\r\n    isLoading$: new BehaviorSubject<boolean>(false),\r\n    cyclePending: false,\r\n    cyclePending$: new BehaviorSubject<boolean>(false),\r\n    loopPending: false,\r\n    loopPending$: new BehaviorSubject<boolean>(false),\r\n    firstVisible: itemAdapterEmpty,\r\n    firstVisible$: new BehaviorSubject<ItemAdapter>(itemAdapterEmpty),\r\n    lastVisible: itemAdapterEmpty,\r\n    lastVisible$: new BehaviorSubject<ItemAdapter>(itemAdapterEmpty),\r\n    itemsCount: 0,\r\n    initialize: () => null,\r\n    reload: () => null,\r\n    showLog: () => null,\r\n    setMinIndex: () => null,\r\n    setScrollPosition: () => null\r\n  }\r\n);\r\n\r\nexport class Adapter implements IAdapter {\r\n\r\n  get init(): boolean {\r\n    return this.isInitialized;\r\n  }\r\n\r\n  get init$(): Observable<boolean> {\r\n    return getIsInitialized(this);\r\n  }\r\n\r\n  get version(): string | null {\r\n    return this.isInitialized ? this.getVersion() : null;\r\n  }\r\n\r\n  get isLoading(): boolean {\r\n    return this.isInitialized ? this.getIsLoading() : false;\r\n  }\r\n\r\n  get isLoading$(): BehaviorSubject<boolean> {\r\n    return getInitializedSubject(this, () => this.getIsLoading$());\r\n  }\r\n\r\n  get loopPending(): boolean {\r\n    return this.isInitialized ? this.getLoopPending() : false;\r\n  }\r\n\r\n  get loopPending$(): BehaviorSubject<boolean> {\r\n    return getInitializedSubject(this, () => this.getLoopPending$());\r\n  }\r\n\r\n  get cyclePending(): boolean {\r\n    return this.isInitialized ? this.getCyclePending() : false;\r\n  }\r\n\r\n  get cyclePending$(): BehaviorSubject<boolean> {\r\n    return getInitializedSubject(this, () => this.getCyclePending$());\r\n  }\r\n\r\n  get firstVisible(): ItemAdapter {\r\n    return this.isInitialized ? this.getFirstVisible() : {};\r\n  }\r\n\r\n  get firstVisible$(): BehaviorSubject<ItemAdapter> {\r\n    return getInitializedSubject(this, () => this.getFirstVisible$());\r\n  }\r\n\r\n  get lastVisible(): ItemAdapter {\r\n    return this.isInitialized ? this.getLastVisible() : {};\r\n  }\r\n\r\n  get lastVisible$(): BehaviorSubject<ItemAdapter> {\r\n    return getInitializedSubject(this, () => this.getLastVisible$());\r\n  }\r\n\r\n  get itemsCount(): number {\r\n    return this.isInitialized ? this.getItemsCount() : 0;\r\n  }\r\n\r\n  private scroller: Scroller;\r\n  private isInitialized: boolean;\r\n  private callWorkflow: Function;\r\n  private getVersion: Function;\r\n  private getIsLoading: Function;\r\n  private getIsLoading$: Function;\r\n  private getCyclePending: Function;\r\n  private getCyclePending$: Function;\r\n  private getLoopPending: Function;\r\n  private getLoopPending$: Function;\r\n  private getItemsCount: Function;\r\n  private getFirstVisible: Function;\r\n  private getFirstVisible$: Function;\r\n  private getLastVisible: Function;\r\n  private getLastVisible$: Function;\r\n\r\n  constructor() {\r\n    this.isInitialized = false;\r\n  }\r\n\r\n  initialize(scroller: Scroller) {\r\n    if (this.isInitialized) {\r\n      return;\r\n    }\r\n    this.scroller = scroller;\r\n    const { state, buffer } = scroller;\r\n    this.isInitialized = true;\r\n    this.callWorkflow = scroller.callWorkflow;\r\n    this.getVersion = (): string | null => scroller.version;\r\n    this.getIsLoading = (): boolean => state.isLoading;\r\n    this.getIsLoading$ = (): BehaviorSubject<boolean> => state.isLoadingSource;\r\n    this.getLoopPending = (): boolean => state.loopPending;\r\n    this.getLoopPending$ = (): BehaviorSubject<boolean> => state.loopPendingSource;\r\n    this.getCyclePending = (): boolean => state.workflowPending;\r\n    this.getCyclePending$ = (): BehaviorSubject<boolean> => state.workflowPendingSource;\r\n    this.getItemsCount = (): number => buffer.getVisibleItemsCount();\r\n    this.initializeProtected(scroller);\r\n  }\r\n\r\n  initializeProtected(scroller: Scroller) {\r\n    const { state } = scroller;\r\n    let getFirstVisibleProtected = () => {\r\n      getFirstVisibleProtected = () => state.firstVisibleItem;\r\n      state.firstVisibleWanted = true;\r\n      return state.firstVisibleItem;\r\n    };\r\n    let getFirstVisible$Protected = () => {\r\n      getFirstVisible$Protected = () => state.firstVisibleSource;\r\n      state.firstVisibleWanted = true;\r\n      return state.firstVisibleSource;\r\n    };\r\n    let getLastVisibleProtected = () => {\r\n      getLastVisibleProtected = () => state.lastVisibleItem;\r\n      state.lastVisibleWanted = true;\r\n      return state.lastVisibleItem;\r\n    };\r\n    let getLastVisible$Protected = () => {\r\n      getLastVisible$Protected = () => state.lastVisibleSource;\r\n      state.lastVisibleWanted = true;\r\n      return state.lastVisibleSource;\r\n    };\r\n    this.getFirstVisible = (): ItemAdapter => getFirstVisibleProtected();\r\n    this.getFirstVisible$ = (): BehaviorSubject<ItemAdapter> => getFirstVisible$Protected();\r\n    this.getLastVisible = (): ItemAdapter => getLastVisibleProtected();\r\n    this.getLastVisible$ = (): BehaviorSubject<ItemAdapter> => getLastVisible$Protected();\r\n  }\r\n\r\n  reload(reloadIndex?: number | string) {\r\n    this.scroller.logger.log(() => `adapter: reload(${reloadIndex})`);\r\n    this.callWorkflow(<ProcessSubject>{\r\n      process: Process.reload,\r\n      status: ProcessStatus.start,\r\n      payload: reloadIndex\r\n    });\r\n  }\r\n\r\n  showLog() {\r\n    this.scroller.logger.logForce();\r\n  }\r\n\r\n  setScrollPosition(value: number) {\r\n    this.scroller.logger.log(() => `adapter: setScrollPosition(${value})`);\r\n    const position = Number(value);\r\n    const parsedValue = parseInt(<any>value, 10);\r\n    if (position !== parsedValue) {\r\n      this.scroller.logger.log(() =>\r\n        `can't set scroll position because ${value} is not an integer`);\r\n    } else {\r\n      this.scroller.state.syntheticScroll.reset();\r\n      this.scroller.viewport.setPosition(value);\r\n    }\r\n  }\r\n\r\n  setMinIndex(value: number) {\r\n    this.scroller.logger.log(() => `adapter: setMinIndex(${value})`);\r\n    const index = Number(value);\r\n    if (isNaN(index)) {\r\n      this.scroller.logger.log(() =>\r\n        `can't set minIndex because ${value} is not a number`);\r\n    } else {\r\n      this.scroller.buffer.minIndexUser = index;\r\n    }\r\n  }\r\n}\r\n","import {\r\n  Datasource as IDatasource, DatasourceGet, DevSettings, Settings, Adapter as IAdapter\r\n} from '../interfaces/index';\r\nimport { Adapter, generateMockAdapter } from './adapter';\r\n\r\nexport class Datasource implements IDatasource {\r\n  readonly constructed: boolean;\r\n  get: DatasourceGet;\r\n  settings?: Settings;\r\n  devSettings?: DevSettings;\r\n  adapter: IAdapter;\r\n\r\n  constructor(datasource: IDatasource, hasNoAdapter?: boolean) {\r\n    this.constructed = true;\r\n    Object.assign(<any>this, datasource);\r\n    if (hasNoAdapter) {\r\n      this.adapter = <IAdapter>generateMockAdapter();\r\n    } else {\r\n      this.adapter = new Adapter();\r\n    }\r\n  }\r\n}\r\n","import { Settings as ISettings, DevSettings as IDevSettings } from '../interfaces/index';\nimport { assignSettings, assignDevSettings } from '../utils/index';\n\nexport const defaultSettings: ISettings = {\n  adapter: false,\n  startIndex: 1,\n  minIndex: -Infinity,\n  maxIndex: Infinity,\n  bufferSize: 5,\n  padding: 0.5,\n  infinite: false,\n  horizontal: false,\n  windowViewport: false\n};\n\nexport const minSettings: ISettings = {\n  itemSize: 1,\n  bufferSize: 1,\n  padding: 0.01\n};\n\nexport const defaultDevSettings: IDevSettings = {\n  debug: false, // if true, logging is enabled; need to turn off when release\n  immediateLog: true, // if false, logging is not immediate and could be done via Workflow.logForce call\n  logTime: false, // if true, time differences are being logged\n  throttle: 40, // if > 0, scroll event handling is throttled (ms)\n  inertia: false, // if true, inertia scroll delay (ms) and delta (px) are taken into the account\n  inertiaScrollDelay: 125,\n  inertiaScrollDelta: 35,\n  initDelay: 1, // if set, the Workflow initialization will be postponed (ms)\n  initWindowDelay: 40, // if set and the entire window is scrollable, the Workflow init will be postponed (ms)\n  maxSynthScrollDelay: 450 // if > 0, synthetic scroll params will be reset after [value] (ms)\n};\n\nexport const minDevSettings: IDevSettings = {\n  throttle: 0,\n  inertiaScrollDelay: 0,\n  inertiaScrollDelta: 0,\n  initDelay: 0,\n  initWindowDelay: 0,\n  maxSynthScrollDelay: 0\n};\n\nexport class Settings implements ISettings {\n\n  // user settings\n  adapter: boolean;\n  startIndex: number;\n  minIndex: number;\n  maxIndex: number;\n  itemSize: number;\n  bufferSize: number;\n  padding: number;\n  infinite: boolean;\n  horizontal: boolean;\n  windowViewport: boolean;\n\n  // development settings\n  debug: boolean;\n  immediateLog: boolean;\n  logTime: boolean;\n  throttle: number;\n  inertia: boolean;\n  inertiaScrollDelay: number;\n  inertiaScrollDelta: number;\n  initDelay: number;\n  initWindowDelay: number;\n  maxSynthScrollDelay: number;\n\n  // internal settings, managed by scroller itself\n  instanceIndex: number;\n  initializeDelay: number;\n\n  constructor(\n    settings: ISettings | undefined, devSettings: IDevSettings | undefined, instanceIndex: number\n  ) {\n    assignSettings(this, settings || {}, defaultSettings, minSettings);\n    assignDevSettings(this, devSettings || {}, defaultDevSettings, minDevSettings);\n    this.instanceIndex = instanceIndex;\n    this.initializeDelay = this.getInitializeDelay();\n    // todo: min/max indexes must be ignored if infinite mode is enabled ??\n  }\n\n  getInitializeDelay(): number {\n    let result = 0;\n    if (this.windowViewport && this.initWindowDelay && !('scrollRestoration' in history)) {\n      result = this.initWindowDelay;\n    }\n    if (this.initDelay > 0) {\n      result = Math.max(result, this.initDelay);\n    }\n    return result;\n  }\n}\n","import { Scroller } from '../scroller';\nimport { Process, ProcessRun, ProcessStatus as Status, ProcessSubject } from '../interfaces/index';\n\nexport class Logger {\n\n  readonly debug: boolean;\n  readonly immediateLog: boolean;\n  readonly logTime: boolean;\n  readonly getTime: Function;\n  readonly getStat: Function;\n  readonly getFetchRange: Function;\n  readonly getInnerLoopCount: Function;\n  readonly getWorkflowCycleData: Function;\n  private logs: Array<any> = [];\n\n  constructor(scroller: Scroller) {\n    const { settings } = scroller;\n    this.debug = settings.debug;\n    this.immediateLog = settings.immediateLog;\n    this.logTime = settings.logTime;\n    this.getTime = (): string =>\n      scroller.state && ` // time: ${scroller.state.time}`;\n    this.getStat = (): string => {\n      const { buffer, viewport } = scroller;\n      const first = buffer.getFirstVisibleItem();\n      const last = buffer.getLastVisibleItem();\n      return 'pos: ' + viewport.scrollPosition + ', ' +\n        'size: ' + viewport.getScrollableSize() + ', ' +\n        'bwd_p: ' + viewport.paddings.backward.size + ', ' +\n        'fwd_p: ' + viewport.paddings.forward.size + ', ' +\n        'aver: ' + (buffer.hasItemSize ? buffer.averageSize : 'no') + ', ' +\n        'items: ' + buffer.getVisibleItemsCount() + ', ' +\n        'range: ' + (first && last ? `[${first.$index}..${last.$index}]` : 'no');\n    };\n    this.getFetchRange = (): string => {\n      const { firstIndex, lastIndex } = scroller.state.fetch;\n      const hasInterval = firstIndex !== null && lastIndex !== null && !isNaN(firstIndex) && !isNaN(lastIndex);\n      return hasInterval ? `[${firstIndex}..${lastIndex}]` : 'no';\n    };\n    this.getInnerLoopCount = (): number => scroller.state.innerLoopCount;\n    this.getWorkflowCycleData = (more: boolean): string =>\n      `${scroller.settings.instanceIndex}-${scroller.state.workflowCycleCount}` + (more ? '-' : '');\n    this.log(() => `uiScroll Workflow has been started (v${scroller.version}, instance ${settings.instanceIndex})`);\n  }\n\n  object(str: string, obj: any, stringify?: boolean) {\n    this.log(() => [\n      str,\n      stringify\n        ? JSON.stringify(obj)\n          .replace(/\"/g, '')\n          .replace(/(\\{|\\:|\\,)/g, '$1 ')\n        : obj\n    ]);\n  }\n\n  stat(str?: string) {\n    if (this.debug) {\n      const logStyles = ['color: #888; border: dashed #888 0; border-bottom-width: 0px', 'color: #000; border-width: 0'];\n      this.log(() => ['%cstat' + (str ? ` ${str}` : '') + ',%c ' + this.getStat(), ...logStyles]);\n    }\n  }\n\n  fetch(str?: string) {\n    if (this.debug) {\n      const _text = 'fetch interval' + (str ? ` ${str}` : '');\n      const logStyles = ['color: #888', 'color: #000'];\n      this.log(() => [`%c${_text}: %c${this.getFetchRange()}`, ...logStyles]);\n    }\n  }\n\n  logProcess(data: ProcessSubject) {\n    if (!this.debug) {\n      return;\n    }\n    const { process, status } = data;\n    const payload: ProcessRun = data.payload || { empty: true };\n\n    // standard process log\n    const processLog = `process ${process}, %c${status}%c` + (!payload.empty ? ',' : '');\n    const styles = [status === Status.error ? 'color: #cc0000;' : '', 'color: #000000;'];\n    this.log(() => [processLog, ...styles, ...(!payload.empty ? [payload] : [])]);\n\n    // inner loop start-end log\n    const workflowCycleData = this.getWorkflowCycleData(true);\n    const loopCount = this.getInnerLoopCount();\n    const loopLog: string[] = [];\n    if (\n      process === Process.init && status === Status.next ||\n      process === Process.scroll && status === Status.next && payload.keepScroll ||\n      process === Process.end && status === Status.next && payload.byTimer\n    ) {\n      loopLog.push(`%c---=== loop ${workflowCycleData + (loopCount + 1)} start`);\n    } else if (\n      process === Process.end && !payload.byTimer\n    ) {\n      loopLog.push(`%c---=== loop ${workflowCycleData + loopCount} done`);\n      if (status === Status.next && !(payload.keepScroll)) {\n        loopLog[0] += `, loop ${workflowCycleData + (loopCount + 1)} start`;\n      }\n    }\n    if (loopLog.length) {\n      this.log(() => [...loopLog, 'color: #006600;']);\n    }\n\n    // workflow cycle start log\n    if (\n      process === Process.init && status === Status.start ||\n      process === Process.reload && status === Status.next ||\n      process === Process.scroll && status === Status.next && !(payload.keepScroll)\n    ) {\n      const logData = this.getWorkflowCycleData(false);\n      const logStyles = 'color: #0000aa; border: solid black 1px; border-width: 1px 0 0 1px; margin-left: -2px';\n      this.log(() => [`%c   ~~~ WF Cycle ${logData} STARTED ~~~  `, logStyles]);\n    }\n\n    // workflow run end log\n    if (process === Process.end && status === Status.done) {\n      const logData = this.getWorkflowCycleData(false);\n      const logStyles = 'color: #0000aa; border: solid #555 1px; border-width: 0 0 1px 1px; margin-left: -2px';\n      this.log(() => [`%c   ~~~ WF Cycle ${logData} FINALIZED ~~~  `, logStyles]);\n    }\n  }\n\n  log(...args: Array<any>) {\n    if (this.debug) {\n      if (typeof args[0] === 'function') {\n        args = args[0]();\n        if (!Array.isArray(args)) {\n          args = [args];\n        }\n      }\n      if (args.every(item => item === undefined)) {\n        return;\n      }\n      if (this.logTime) {\n        args = [...args, this.getTime()];\n      }\n      if (this.immediateLog) {\n        console.log.apply(this, args);\n      } else {\n        this.logs.push(args);\n      }\n    }\n  }\n\n  logForce(...args: Array<any>) {\n    if (this.debug) {\n      if (!this.immediateLog && this.logs.length) {\n        this.logs.forEach(logArgs => console.log.apply(this, logArgs));\n        this.logs = [];\n      }\n      if (args.length) {\n        console.log.apply(this, args);\n      }\n    }\n  }\n}\n","import { Direction } from '../interfaces/direction';\nimport { Settings } from './settings';\n\nexport class Routines {\n\n  readonly horizontal: boolean;\n\n  constructor(settings: Settings) {\n    this.horizontal = settings.horizontal;\n  }\n\n  getScrollPosition(element: HTMLElement): number {\n    return element[this.horizontal ? 'scrollLeft' : 'scrollTop'];\n  }\n\n  setScrollPosition(element: HTMLElement, value: number) {\n    element[this.horizontal ? 'scrollLeft' : 'scrollTop'] = value;\n  }\n\n  getParams(element: HTMLElement): ClientRect {\n    if (element.tagName.toLowerCase() === 'body') {\n      element = <HTMLElement>element.parentElement;\n      return <ClientRect>{\n        'height': element.clientHeight,\n        'width': element.clientWidth,\n        'top': element.clientTop,\n        'bottom': element.clientTop + element.clientHeight,\n        'left': element.clientLeft,\n        'right': element.clientLeft + element.clientWidth\n      };\n    }\n    return element.getBoundingClientRect();\n  }\n\n  getSize(element: HTMLElement): number {\n    return this.getParams(element)[this.horizontal ? 'width' : 'height'];\n  }\n\n  getSizeStyle(element: HTMLElement): number {\n    const size = element.style[this.horizontal ? 'width' : 'height'];\n    return parseInt(<string>size, 10) || 0;\n  }\n\n  setSizeStyle(element: HTMLElement, value: number) {\n    element.style[this.horizontal ? 'width' : 'height'] = `${value}px`;\n  }\n\n  getRectEdge(params: ClientRect, direction: Direction, opposite?: boolean): number {\n    const forward = !opposite ? Direction.forward : Direction.backward;\n    return params[direction === forward ? (this.horizontal ? 'right' : 'bottom') : (this.horizontal ? 'left' : 'top')];\n  }\n\n  getEdge(element: HTMLElement, direction: Direction, opposite?: boolean): number {\n    const params = this.getParams(element);\n    return this.getRectEdge(params, direction, opposite);\n  }\n\n  getEdge2(element: HTMLElement, direction: Direction, relativeElement: HTMLElement, opposite: boolean): number {\n    // vertical only ?\n    return element.offsetTop - (relativeElement ? relativeElement.scrollTop : 0) +\n      (direction === (!opposite ? Direction.forward : Direction.backward) ? this.getSize(element) : 0);\n  }\n\n  hideElement(element: HTMLElement) {\n    element.style.display = 'none';\n  }\n\n  getOffset(element: HTMLElement): number {\n    return this.horizontal ? element.offsetLeft : element.offsetTop;\n  }\n\n}\n","import { Direction } from '../interfaces/direction';\r\nimport { Routines } from './domRoutines';\r\nimport { Settings } from './settings';\r\n\r\nexport class Padding {\r\n\r\n  element: HTMLElement;\r\n  direction: Direction;\r\n  routines: Routines;\r\n\r\n  constructor(element: HTMLElement, direction: Direction, routines: Routines) {\r\n    this.element = <HTMLElement>element.querySelector(`[data-padding-${direction}]`);\r\n    this.direction = direction;\r\n    this.routines = routines;\r\n  }\r\n\r\n  reset(size?: number) {\r\n    this.size = size || 0;\r\n  }\r\n\r\n  get size(): number {\r\n    return this.routines.getSizeStyle(this.element);\r\n  }\r\n\r\n  set size(value: number) {\r\n    this.routines.setSizeStyle(this.element, Math.round(value));\r\n  }\r\n\r\n}\r\n\r\nexport class Paddings {\r\n  settings: Settings;\r\n  forward: Padding;\r\n  backward: Padding;\r\n\r\n  constructor(element: HTMLElement, routines: Routines, settings: Settings) {\r\n    this.settings = settings;\r\n    this.forward = new Padding(element, Direction.forward, routines);\r\n    this.backward = new Padding(element, Direction.backward, routines);\r\n  }\r\n\r\n  reset(viewportSize: number, startIndex: number) {\r\n    this.forward.reset(this.getPositiveSize(startIndex, viewportSize));\r\n    this.backward.reset(this.getNegativeSize(startIndex));\r\n  }\r\n\r\n  getPositiveSize(startIndex: number, viewportSize: number) {\r\n    const { settings } = this;\r\n    let positiveSize = viewportSize;\r\n    if (isFinite(settings.maxIndex)) {\r\n      positiveSize = (settings.maxIndex - startIndex + 1) * settings.itemSize;\r\n    }\r\n    return positiveSize;\r\n  }\r\n\r\n  getNegativeSize(startIndex: number) {\r\n    const { settings } = this;\r\n    let negativeSize = 0;\r\n    if (isFinite(settings.minIndex)) {\r\n      negativeSize = (startIndex - settings.minIndex) * settings.itemSize;\r\n    }\r\n    return negativeSize;\r\n  }\r\n}\r\n","import { ElementRef } from '@angular/core';\n\nimport { Direction } from '../interfaces/index';\nimport { Paddings } from './paddings';\nimport { Settings } from './settings';\nimport { Routines } from './domRoutines';\nimport { State } from './state';\nimport { Logger } from './logger';\n\nexport class Viewport {\n\n  paddings: Paddings;\n  startDelta: number;\n\n  readonly element: HTMLElement;\n  readonly host: HTMLElement;\n  readonly scrollEventElement: HTMLElement | Document;\n  readonly scrollable: HTMLElement;\n  readonly settings: Settings;\n  readonly routines: Routines;\n  readonly state: State;\n  readonly logger: Logger;\n\n  constructor(elementRef: ElementRef, settings: Settings, routines: Routines, state: State, logger: Logger) {\n    this.settings = settings;\n    this.routines = routines;\n    this.state = state;\n    this.logger = logger;\n    this.element = elementRef.nativeElement;\n\n    if (settings.windowViewport) {\n      this.host = (<Document>this.element.ownerDocument).body;\n      this.scrollEventElement = <Document>(this.element.ownerDocument);\n      this.scrollable = <HTMLElement>this.scrollEventElement.scrollingElement;\n    } else {\n      this.host = <HTMLElement>this.element.parentElement;\n      this.scrollEventElement = this.host;\n      this.scrollable = <HTMLElement>this.element.parentElement;\n    }\n\n    this.paddings = new Paddings(this.element, this.routines, settings);\n\n    if (settings.windowViewport && 'scrollRestoration' in history) {\n      history.scrollRestoration = 'manual';\n    }\n  }\n\n  reset(scrollPosition: number) {\n    let newPosition = 0;\n    this.paddings.reset(this.getSize(), this.state.startIndex);\n    const negativeSize = this.paddings.backward.size;\n    if (negativeSize) {\n      newPosition = negativeSize;\n      this.state.bwdPaddingAverageSizeItemsCount = negativeSize / this.settings.itemSize;\n    }\n    this.scrollPosition = newPosition;\n    this.state.scrollState.reset();\n    this.state.syntheticScroll.reset(scrollPosition !== newPosition ? newPosition : null);\n    this.startDelta = 0;\n  }\n\n  setPosition(value: number, oldPosition?: number): number {\n    if (oldPosition === undefined) {\n      oldPosition = this.scrollPosition;\n    }\n    if (oldPosition === value) {\n      this.logger.log(() => ['setting scroll position at', value, '[cancelled]']);\n      return value;\n    }\n    this.routines.setScrollPosition(this.scrollable, value);\n    const position = this.scrollPosition;\n    this.logger.log(() => ['setting scroll position at', position]);\n    return position;\n  }\n\n  get scrollPosition(): number {\n    return this.routines.getScrollPosition(this.scrollable);\n  }\n\n  set scrollPosition(value: number) {\n    const oldPosition = this.scrollPosition;\n    const newPosition = this.setPosition(value, oldPosition);\n    const synthState = this.state.syntheticScroll;\n    synthState.time = Number(Date.now());\n    synthState.position = newPosition;\n    synthState.delta = newPosition - oldPosition;\n    if (synthState.positionBefore === null) {\n      // syntheticScroll.positionBefore should be set once per cycle\n      synthState.positionBefore = oldPosition;\n    }\n  }\n\n  getSize(): number {\n    return this.routines.getSize(this.host);\n  }\n\n  getScrollableSize(): number {\n    return this.routines.getSize(this.element);\n  }\n\n  getBufferPadding(): number {\n    return this.getSize() * this.settings.padding;\n  }\n\n  getEdge(direction: Direction, opposite?: boolean): number {\n    return this.routines.getEdge(this.host, direction, opposite);\n  }\n\n  getElementEdge(element: HTMLElement, direction: Direction, opposite?: boolean): number {\n    return this.routines.getEdge(element, direction, opposite);\n  }\n\n  getOffset(): number {\n    return this.routines.getOffset(this.element);\n  }\n\n}\n","import { Item } from './item';\nimport { Settings } from '../classes/settings';\nimport { Logger } from './logger';\n\nexport class ItemCache {\n  $index: number;\n  nodeId: string;\n  data: any; // todo: cache data only if it is permitted by settings\n  size: number;\n  position: number;\n\n  constructor(item: Item) {\n    this.$index = item.$index;\n    this.nodeId = item.nodeId;\n    this.data = item.data;\n    this.size = item.size;\n  }\n}\n\nexport class RecalculateAverage {\n  newItems: Array<number>;\n  oldItems: Array<number>;\n\n  constructor() {\n    this.reset();\n  }\n\n  reset() {\n    this.newItems = [];\n    this.oldItems = [];\n  }\n}\n\nexport class Cache {\n  averageSizeFloat: number;\n  averageSize: number;\n  minIndex: number;\n  maxIndex: number;\n  recalculateAverage: RecalculateAverage;\n\n  private items: Map<number, ItemCache>;\n  readonly logger: Logger;\n  readonly itemSize: number;\n\n  constructor(itemSize: number, logger: Logger) {\n    this.averageSizeFloat = itemSize;\n    this.averageSize = itemSize;\n    this.itemSize = itemSize;\n    this.items = new Map<number, ItemCache>();\n    this.recalculateAverage = new RecalculateAverage();\n    this.reset();\n    this.logger = logger;\n  }\n\n  reset() {\n    this.minIndex = +Infinity;\n    this.maxIndex = -Infinity;\n    this.items.clear();\n    this.averageSizeFloat = this.itemSize;\n    this.averageSize = this.itemSize;\n    this.recalculateAverage.reset();\n  }\n\n  recalculateAverageSize() {\n    const { oldItems: { length: oldItemsLength }, newItems: { length: newItemsLength } } = this.recalculateAverage;\n    if (!oldItemsLength && !newItemsLength) {\n      return;\n    }\n    const oldItemsSize = this.recalculateAverage.oldItems.reduce((acc, index) => acc + this.getItemSize(index), 0);\n    const newItemsSize = this.recalculateAverage.newItems.reduce((acc, index) => acc + this.getItemSize(index), 0);\n    if (oldItemsLength) {\n      const averageSize = this.averageSizeFloat || 0;\n      const averageSizeLength = this.items.size - newItemsLength - oldItemsLength;\n      this.averageSizeFloat = (averageSizeLength * averageSize + oldItemsSize) / averageSizeLength;\n    }\n    if (newItemsLength) {\n      const averageSize = this.averageSizeFloat || 0;\n      const averageSizeLength = this.items.size - newItemsLength;\n      this.averageSizeFloat = (averageSizeLength * averageSize + newItemsSize) / this.items.size;\n    }\n    this.averageSize = Math.round(this.averageSizeFloat);\n    this.recalculateAverage.reset();\n    this.logger.log(() => `average size has been updated: ${this.averageSize}`);\n  }\n\n  add(item: Item): ItemCache {\n    let itemCache = this.get(item.$index);\n    if (itemCache) {\n      itemCache.data = item.data;\n      if (itemCache.size !== item.size) {\n        itemCache.size = item.size;\n        this.recalculateAverage.oldItems.push(item.$index);\n      }\n    } else {\n      itemCache = new ItemCache(item);\n      this.items.set(item.$index, itemCache);\n      if (this.averageSize !== itemCache.size) {\n        this.recalculateAverage.newItems.push(item.$index);\n      }\n    }\n    if (item.$index < this.minIndex) {\n      this.minIndex = item.$index;\n    }\n    if (item.$index > this.maxIndex) {\n      this.maxIndex = item.$index;\n    }\n    return itemCache;\n  }\n\n  getItemSize(index: number): number {\n    const item = this.get(index);\n    return item ? item.size : 0;\n  }\n\n  get(index: number): ItemCache | undefined {\n    return this.items.get(index);\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { Direction } from '../interfaces/index';\nimport { Cache } from './cache';\nimport { Item } from './item';\nimport { Settings } from './settings';\nimport { Logger } from './logger';\n\nexport class Buffer {\n\n  private _items: Array<Item>;\n  $items: BehaviorSubject<Array<Item>>;\n\n  pristine: boolean;\n  cache: Cache;\n  minIndexUser: number;\n  maxIndexUser: number;\n  absMinIndex: number;\n  absMaxIndex: number;\n\n  private startIndex: number;\n  readonly minBufferSize: number;\n  readonly logger: Logger;\n\n  constructor(settings: Settings, startIndex: number, logger: Logger) {\n    this.$items = new BehaviorSubject<Array<Item>>([]);\n    this.cache = new Cache(settings.itemSize, logger);\n    this.minIndexUser = settings.minIndex;\n    this.maxIndexUser = settings.maxIndex;\n    this.reset();\n    this.startIndex = startIndex;\n    this.minBufferSize = settings.bufferSize;\n    this.logger = logger;\n  }\n\n  reset(reload?: boolean, startIndex?: number) {\n    if (reload) {\n      this.items.forEach(item => item.hide());\n    }\n    this.items = [];\n    this.pristine = true;\n    this.cache.reset();\n    this.absMinIndex = this.minIndexUser;\n    this.absMaxIndex = this.maxIndexUser;\n    if (typeof startIndex !== 'undefined') {\n      this.startIndex = startIndex;\n    }\n  }\n\n  set items(items: Array<Item>) {\n    this.pristine = false;\n    this._items = items;\n    this.$items.next(items);\n  }\n\n  get items(): Array<Item> {\n    return this._items;\n  }\n\n  get size(): number {\n    return this._items.length;\n  }\n\n  get averageSize(): number {\n    return this.cache.averageSize;\n  }\n\n  get hasItemSize(): boolean {\n    return this.averageSize !== undefined;\n  }\n\n  get minIndex(): number {\n    return isFinite(this.cache.minIndex) ? this.cache.minIndex : this.startIndex;\n  }\n\n  get maxIndex(): number {\n    return isFinite(this.cache.maxIndex) ? this.cache.maxIndex : this.startIndex;\n  }\n\n  get bof(): boolean {\n    return this.items.length ? (this.items[0].$index === this.absMinIndex) :\n      isFinite(this.absMinIndex);\n  }\n\n  get eof(): boolean {\n    return this.items.length ? (this.items[this.items.length - 1].$index === this.absMaxIndex) :\n      isFinite(this.absMaxIndex);\n  }\n\n  get($index: number): Item | undefined {\n    return this.items.find((item: Item) => item.$index === $index);\n  }\n\n  setItems(items: Array<Item>): boolean {\n    if (!this.items.length) {\n      this.items = items;\n    } else if (this.items[0].$index > items[items.length - 1].$index) {\n      this.items = [...items, ...this.items];\n    } else if (items[0].$index > this.items[this.items.length - 1].$index) {\n      this.items = [...this.items, ...items];\n    } else {\n      return false;\n    }\n    return true;\n  }\n\n  getFirstVisibleItemIndex(): number {\n    const length = this.items.length;\n    for (let i = 0; i < length; i++) {\n      if (!this.items[i].invisible) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  getLastVisibleItemIndex(): number {\n    for (let i = this.items.length - 1; i >= 0; i--) {\n      if (!this.items[i].invisible) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  getFirstVisibleItem(): Item | undefined {\n    const index = this.getFirstVisibleItemIndex();\n    if (index >= 0) {\n      return this.items[index];\n    }\n  }\n\n  getLastVisibleItem(): Item | undefined {\n    const index = this.getLastVisibleItemIndex();\n    if (index >= 0) {\n      return this.items[index];\n    }\n  }\n\n  getEdgeVisibleItem(direction: Direction, opposite?: boolean): Item | undefined {\n    return direction === (!opposite ? Direction.forward : Direction.backward) ?\n      this.getLastVisibleItem() : this.getFirstVisibleItem();\n  }\n\n  getVisibleItemsCount(): number {\n    return this.items.reduce((acc: number, item: Item) => acc + (item.invisible ? 0 : 1), 0);\n  }\n\n  getSizeByIndex(index: number): number {\n    const item = this.cache.get(index);\n    return item ? item.size : this.averageSize;\n  }\n\n  checkAverageSize() {\n    this.cache.recalculateAverageSize();\n  }\n\n}\n","import { Item } from './item';\nimport { Direction } from '../interfaces/index';\n\nexport class FetchModel {\n  private _newItemsData: Array<any> | null;\n  items: Array<Item>;\n  firstIndexBuffer: number | null;\n  lastIndexBuffer: number | null;\n  firstIndex: number | null;\n  lastIndex: number | null;\n  hasAnotherPack: boolean;\n  callCount: number;\n  minIndex: number;\n  negativeSize: number;\n  averageItemSize: number;\n  direction: Direction | null;\n  isPrepend: boolean;\n\n  constructor() {\n    this.callCount = 0;\n    this.reset();\n  }\n\n  reset() {\n    this._newItemsData = null;\n    this.items = [];\n    this.firstIndexBuffer = null;\n    this.lastIndexBuffer = null;\n    this.firstIndex = null;\n    this.lastIndex = null;\n    this.hasAnotherPack = false;\n    this.negativeSize = 0;\n    this.direction = null;\n    this.isPrepend = false;\n  }\n\n  get newItemsData(): Array<Item> | null {\n    return this._newItemsData;\n  }\n\n  set newItemsData(items: Array<Item> | null) {\n    this._newItemsData = items;\n    this.callCount++;\n  }\n\n  get shouldFetch(): boolean {\n    return !!this.count;\n  }\n\n  get hasNewItems(): boolean {\n    return !!((this._newItemsData && this._newItemsData.length));\n  }\n\n  get index(): number | null {\n    return this.firstIndex;\n  }\n\n  get count(): number {\n    return this.firstIndex !== null && this.lastIndex !== null ? this.lastIndex - this.firstIndex + 1 : 0;\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\r\n\r\nimport {\r\n  State as IState,\r\n  ProcessRun,\r\n  ItemAdapter,\r\n  WindowScrollState as IWindowScrollState,\r\n  ScrollState as IScrollState,\r\n  SyntheticScroll as ISyntheticScroll\r\n} from '../interfaces/index';\r\nimport { FetchModel } from './fetch';\r\nimport { Settings } from './settings';\r\nimport { Logger } from './logger';\r\nimport { itemAdapterEmpty } from './adapter';\r\n\r\nclass WindowScrollState implements IWindowScrollState {\r\n  positionToUpdate: number;\r\n  delta: number;\r\n\r\n  constructor() {\r\n    this.reset();\r\n  }\r\n\r\n  reset() {\r\n    this.delta = 0;\r\n    this.positionToUpdate = 0;\r\n  }\r\n}\r\n\r\nclass ScrollState implements IScrollState {\r\n  firstScroll: boolean;\r\n  firstScrollTime: number;\r\n  lastScrollTime: number;\r\n  scrollTimer: number | null;\r\n  workflowTimer: number | null;\r\n  scroll: boolean;\r\n  keepScroll: boolean;\r\n  window: IWindowScrollState;\r\n\r\n  constructor() {\r\n    this.window = new WindowScrollState();\r\n    this.reset();\r\n  }\r\n\r\n  reset() {\r\n    this.firstScroll = false;\r\n    this.firstScrollTime = 0;\r\n    this.lastScrollTime = 0;\r\n    this.scrollTimer = null;\r\n    this.workflowTimer = null;\r\n    this.scroll = false;\r\n    this.keepScroll = false;\r\n    this.window.reset();\r\n  }\r\n}\r\n\r\nclass SyntheticScroll implements ISyntheticScroll {\r\n  position: number | null;\r\n  positionBefore: number | null;\r\n  delta: number;\r\n  time: number;\r\n  readyToReset: boolean;\r\n\r\n  constructor() {\r\n    this.reset(null);\r\n  }\r\n\r\n  reset(position: number | null = null) {\r\n    this.position = position;\r\n    this.positionBefore = null;\r\n    this.delta = 0;\r\n    this.time = 0;\r\n    this.readyToReset = false;\r\n  }\r\n}\r\n\r\nexport class State implements IState {\r\n\r\n  protected settings: Settings;\r\n  protected logger: Logger;\r\n\r\n  initTime: number;\r\n  innerLoopCount: number;\r\n  isInitialLoop: boolean;\r\n  workflowCycleCount: number;\r\n  isInitialWorkflowCycle: boolean;\r\n  countDone: number;\r\n\r\n  startIndex: number;\r\n  fetch: FetchModel;\r\n  clip: boolean;\r\n  clipCall: number;\r\n  lastPosition: number;\r\n  preFetchPosition: number;\r\n  preAdjustPosition: number;\r\n  sizeBeforeRender: number;\r\n  fwdPaddingBeforeRender: number;\r\n  bwdPaddingAverageSizeItemsCount: number;\r\n\r\n  scrollState: IScrollState;\r\n  syntheticScroll: ISyntheticScroll;\r\n\r\n  loopPendingSource: BehaviorSubject<boolean>;\r\n  workflowPendingSource: BehaviorSubject<boolean>;\r\n  isLoadingSource: BehaviorSubject<boolean>;\r\n  firstVisibleSource: BehaviorSubject<ItemAdapter>;\r\n  lastVisibleSource: BehaviorSubject<ItemAdapter>;\r\n  firstVisibleWanted: boolean;\r\n  lastVisibleWanted: boolean;\r\n\r\n  get loopPending(): boolean {\r\n    return this.loopPendingSource.getValue();\r\n  }\r\n\r\n  set loopPending(value: boolean) {\r\n    if (this.loopPending !== value) {\r\n      this.loopPendingSource.next(value);\r\n    }\r\n  }\r\n\r\n  get workflowPending(): boolean {\r\n    return this.workflowPendingSource.getValue();\r\n  }\r\n\r\n  set workflowPending(value: boolean) {\r\n    if (this.workflowPending !== value) {\r\n      this.workflowPendingSource.next(value);\r\n    }\r\n  }\r\n\r\n  get isLoading(): boolean {\r\n    return this.isLoadingSource.getValue();\r\n  }\r\n\r\n  set isLoading(value: boolean) {\r\n    if (this.isLoading !== value) {\r\n      this.isLoadingSource.next(value);\r\n    }\r\n  }\r\n\r\n  get firstVisibleItem(): ItemAdapter {\r\n    return this.firstVisibleSource.getValue();\r\n  }\r\n\r\n  set firstVisibleItem(item: ItemAdapter) {\r\n    if (this.firstVisibleItem.$index !== item.$index) {\r\n      this.firstVisibleSource.next(item);\r\n    }\r\n  }\r\n\r\n  get lastVisibleItem(): ItemAdapter {\r\n    return this.lastVisibleSource.getValue();\r\n  }\r\n\r\n  set lastVisibleItem(item: ItemAdapter) {\r\n    if (this.lastVisibleItem.$index !== item.$index) {\r\n      this.lastVisibleSource.next(item);\r\n    }\r\n  }\r\n\r\n  get time(): number {\r\n    return Number(new Date()) - this.initTime;\r\n  }\r\n\r\n  constructor(settings: Settings, logger: Logger) {\r\n    this.settings = settings;\r\n    this.logger = logger;\r\n    this.initTime = Number(new Date());\r\n    this.innerLoopCount = 0;\r\n    this.isInitialLoop = false;\r\n    this.workflowCycleCount = 1;\r\n    this.isInitialWorkflowCycle = false;\r\n    this.countDone = 0;\r\n\r\n    this.setCurrentStartIndex(settings.startIndex);\r\n    this.fetch = new FetchModel();\r\n    this.clip = false;\r\n    this.clipCall = 0;\r\n    this.sizeBeforeRender = 0;\r\n    this.fwdPaddingBeforeRender = 0;\r\n    this.bwdPaddingAverageSizeItemsCount = 0;\r\n\r\n    this.scrollState = new ScrollState();\r\n    this.syntheticScroll = new SyntheticScroll();\r\n\r\n    this.loopPendingSource = new BehaviorSubject<boolean>(false);\r\n    this.workflowPendingSource = new BehaviorSubject<boolean>(false);\r\n    this.isLoadingSource = new BehaviorSubject<boolean>(false);\r\n    this.firstVisibleSource = new BehaviorSubject<ItemAdapter>(itemAdapterEmpty);\r\n    this.lastVisibleSource = new BehaviorSubject<ItemAdapter>(itemAdapterEmpty);\r\n    this.firstVisibleWanted = false;\r\n    this.lastVisibleWanted = false;\r\n  }\r\n\r\n  startLoop(options?: ProcessRun) {\r\n    this.loopPending = true;\r\n    this.innerLoopCount++;\r\n    this.fetch.reset();\r\n    this.clip = false;\r\n    if (options) {\r\n      this.scrollState.scroll = options.scroll || false;\r\n    }\r\n    this.scrollState.keepScroll = false;\r\n  }\r\n\r\n  endLoop() {\r\n    this.loopPending = false;\r\n    this.countDone++;\r\n    this.isInitialLoop = false;\r\n  }\r\n\r\n  setCurrentStartIndex(newStartIndex: any) {\r\n    const { startIndex, minIndex, maxIndex } = this.settings;\r\n    let index = Number(newStartIndex);\r\n    if (isNaN(index)) {\r\n      this.logger.log(() =>\r\n        `fallback startIndex to settings.startIndex (${startIndex}) because ${newStartIndex} is not a number`);\r\n      index = startIndex;\r\n    }\r\n    if (index < minIndex) {\r\n      this.logger.log(() => `setting startIndex to settings.minIndex (${minIndex}) because ${index} < ${minIndex}`);\r\n      index = minIndex;\r\n    }\r\n    if (index > maxIndex) {\r\n      this.logger.log(() => `setting startIndex to settings.maxIndex (${maxIndex}) because ${index} > ${maxIndex}`);\r\n      index = maxIndex;\r\n    }\r\n    this.startIndex = index;\r\n  }\r\n\r\n}\r\n","import { Observable, Subscription, Observer } from 'rxjs';\n\nimport { UiScrollComponent } from '../ui-scroll.component';\nimport { checkDatasource } from './utils/index';\nimport { Datasource } from './classes/datasource';\nimport { Settings } from './classes/settings';\nimport { Logger } from './classes/logger';\nimport { Routines } from './classes/domRoutines';\nimport { Viewport } from './classes/viewport';\nimport { Buffer } from './classes/buffer';\nimport { State } from './classes/state';\nimport { CallWorkflow } from './interfaces/index';\n\nlet instanceCount = 0;\n\nexport class Scroller {\n\n  readonly runChangeDetector: Function;\n  readonly callWorkflow: CallWorkflow;\n\n  public version: string;\n  public datasource: Datasource;\n  public settings: Settings;\n  public logger: Logger;\n  public routines: Routines;\n  public viewport: Viewport;\n  public buffer: Buffer;\n  public state: State;\n\n  public innerLoopSubscriptions: Array<Subscription>;\n\n  constructor(context: UiScrollComponent, callWorkflow: CallWorkflow) {\n    const datasource = <Datasource>checkDatasource(context.datasource);\n    this.datasource = datasource;\n    this.version = context.version;\n\n    this.runChangeDetector = () => context.changeDetector.markForCheck();\n    // this.runChangeDetector = () => context.changeDetector.detectChanges();\n    this.callWorkflow = callWorkflow;\n    this.innerLoopSubscriptions = [];\n\n    this.settings = new Settings(datasource.settings, datasource.devSettings, ++instanceCount);\n    this.logger = new Logger(this);\n    this.routines = new Routines(this.settings);\n    this.state = new State(this.settings, this.logger);\n    this.buffer = new Buffer(this.settings, this.state.startIndex, this.logger);\n    this.viewport = new Viewport(context.elementRef, this.settings, this.routines, this.state, this.logger);\n\n    this.logger.object('uiScroll settings object', this.settings, true);\n\n    if (!datasource.constructed) {\n      this.datasource = new Datasource(datasource, !this.settings.adapter);\n      if (this.settings.adapter) {\n        this.datasource.adapter.initialize(this);\n      }\n    } else {\n      this.datasource.adapter.initialize(this);\n    }\n  }\n\n  init() {\n    this.viewport.reset(0);\n  }\n\n  bindData(): Observable<any> {\n    this.runChangeDetector();\n    return Observable.create((observer: Observer<any>) => {\n        setTimeout(() => {\n          observer.next(true);\n          observer.complete();\n        });\n      }\n    );\n  }\n\n  purgeInnerLoopSubscriptions() {\n    this.innerLoopSubscriptions.forEach((item: Subscription) => item.unsubscribe());\n    this.innerLoopSubscriptions = [];\n  }\n\n  purgeScrollTimers(localOnly?: boolean) {\n    const { state: { scrollState } } = this;\n    if (scrollState.scrollTimer) {\n      clearTimeout(scrollState.scrollTimer);\n      scrollState.scrollTimer = null;\n    }\n    if (!localOnly && scrollState.workflowTimer) {\n      clearTimeout(scrollState.workflowTimer);\n      scrollState.workflowTimer = null;\n    }\n  }\n\n  dispose() {\n    this.purgeInnerLoopSubscriptions();\n    this.purgeScrollTimers();\n  }\n\n  finalize() {\n  }\n\n}\n","import { Scroller } from '../scroller';\nimport { Process, ProcessStatus, ProcessRun } from '../interfaces/index';\n\nexport default class Init {\n\n  static run(scroller: Scroller, payload?: ProcessRun) {\n    scroller.state.isInitialWorkflowCycle = !payload;\n    scroller.state.isInitialLoop = !payload;\n    scroller.state.workflowPending = true;\n    scroller.state.isLoading = true;\n    scroller.callWorkflow({\n      process: Process.init,\n      status: ProcessStatus.next,\n      payload: {\n        scroll: payload && payload.scroll || false\n      }\n    });\n  }\n\n}\n","import { Scroller } from '../scroller';\nimport { Process, ProcessStatus, ScrollPayload } from '../interfaces/index';\n\nexport default class Scroll {\n\n  static run(scroller: Scroller, payload: ScrollPayload = {}) {\n    scroller.logger.log(scroller.viewport.scrollPosition);\n    if (scroller.state.syntheticScroll.position !== null) {\n      if (!Scroll.processSyntheticScroll(scroller)) {\n        return;\n      }\n    }\n    this.delayScroll(scroller, payload);\n  }\n\n  static processSyntheticScroll(scroller: Scroller): boolean {\n    const { viewport, state: { syntheticScroll }, settings, logger } = scroller;\n    const time = Number(new Date());\n    const synthetic = { ...syntheticScroll };\n    const position = viewport.scrollPosition;\n    const synthScrollDelay = time - synthetic.time;\n\n    if (synthScrollDelay > settings.maxSynthScrollDelay) {\n      logger.log(() => `reset synthetic scroll params (${synthScrollDelay} > ${settings.maxSynthScrollDelay})`);\n      syntheticScroll.reset();\n      return position !== synthetic.position;\n    }\n\n    // synthetic scroll\n    syntheticScroll.readyToReset = true;\n    if (position === synthetic.position) {\n      // let's reset syntheticScroll.position on first change\n      logger.log(() => `skip synthetic scroll (${position})`);\n      return false;\n    } else if (synthetic.readyToReset) {\n      syntheticScroll.position = null;\n      syntheticScroll.positionBefore = null;\n      logger.log(() => 'reset synthetic scroll params');\n    }\n    if (settings.windowViewport) {\n      if (!synthetic.readyToReset) {\n        logger.log(() => 'reset synthetic scroll params (window)');\n        syntheticScroll.reset();\n      }\n      return true;\n    }\n\n    // inertia scroll over synthetic scroll\n    if (position !== synthetic.position) {\n      const inertiaDelta = <number>synthetic.positionBefore - position;\n      const syntheticDelta = <number>synthetic.position - position;\n      if (inertiaDelta > 0 && inertiaDelta < syntheticDelta) {\n        const newPosition = Math.max(0, position + syntheticScroll.delta);\n        logger.log(() => 'inertia scroll adjustment' +\n          '. Position: ' + position +\n          ', synthetic position: ' + synthetic.position +\n          ', synthetic position before: ' + synthetic.positionBefore +\n          ', synthetic delay: ' + synthScrollDelay +\n          ', synthetic delta: ' + syntheticDelta +\n          ', inertia delta: ' + inertiaDelta +\n          ', new position: ' + newPosition);\n        if (settings.inertia) { // precise inertia settings\n          if (inertiaDelta <= settings.inertiaScrollDelta && synthScrollDelay <= settings.inertiaScrollDelay) {\n            viewport.scrollPosition = newPosition;\n          }\n        } else {\n          viewport.scrollPosition = newPosition;\n        }\n      } /* else {\n        logger.log(() => 'inertia scroll adjustment [cancelled]' +\n          '. Position: ' + position +\n          ', synthetic position: ' + synthetic.position +\n          ', synthetic position before: ' + synthetic.positionBefore +\n          ', synthetic delta: ' + syntheticDelta + ', inertia delta: ' + inertiaDelta);\n      } */\n    }\n    return true;\n  }\n\n  static delayScroll(scroller: Scroller, payload: ScrollPayload) {\n    if (!scroller.settings.throttle || payload.byTimer) {\n      Scroll.doScroll(scroller);\n      return;\n    }\n    const { state: { scrollState } } = scroller;\n    const time = Number(Date.now());\n    const tDiff = scrollState.lastScrollTime + scroller.settings.throttle - time;\n    const dDiff = scroller.settings.throttle + (scrollState.firstScrollTime ? scrollState.firstScrollTime - time : 0);\n    const diff = Math.max(tDiff, dDiff);\n    // scroller.logger.log('tDiff:', tDiff, 'dDiff:', dDiff, 'diff:', diff);\n    if (diff <= 0) {\n      scroller.purgeScrollTimers(true);\n      scrollState.lastScrollTime = time;\n      scrollState.firstScrollTime = 0;\n      Scroll.doScroll(scroller);\n    } else if (!scrollState.scrollTimer && !scrollState.keepScroll) {\n      scroller.logger.log(() => `setting the timer at ${scroller.state.time + diff}`);\n      scrollState.firstScrollTime = time;\n      scrollState.scrollTimer = <any>setTimeout(() => {\n        scrollState.scrollTimer = null;\n        scroller.logger.log(() => `fire the timer (${scroller.state.time})`);\n        Scroll.run(scroller, { byTimer: true });\n      }, diff);\n    } /* else {\n      scroller.logger.log('MISS TIMER');\n    } */\n  }\n\n  static doScroll(scroller: Scroller) {\n    const { state, state: { scrollState } } = scroller;\n    if (state.workflowPending) {\n      scroller.logger.log(() =>\n        !scrollState.keepScroll ? [\n          `setting %ckeepScroll%c flag (scrolling while the Workflow is pending)`,\n          'color: #006600;', 'color: #000000;'\n        ] : undefined);\n      scrollState.keepScroll = true;\n      return;\n    }\n    scroller.callWorkflow({\n      process: Process.scroll,\n      status: ProcessStatus.next,\n      payload: {\n        scroll: true,\n        ...(scrollState.keepScroll ? { keepScroll: scrollState.keepScroll } : {})\n      }\n    });\n  }\n\n}\n","import { Scroller } from '../scroller';\nimport { Process, ProcessStatus } from '../interfaces/index';\n\nexport default class Reload {\n\n  static run(scroller: Scroller, reloadIndex: any) {\n    const scrollPosition = scroller.viewport.scrollPosition;\n    scroller.state.setCurrentStartIndex(reloadIndex);\n    scroller.buffer.reset(true, scroller.state.startIndex);\n    scroller.viewport.reset(scrollPosition);\n    scroller.purgeInnerLoopSubscriptions();\n    scroller.purgeScrollTimers();\n    // todo: do we need to have Process.end before?\n    scroller.callWorkflow({\n      process: Process.reload,\n      status: ProcessStatus.next\n    });\n  }\n\n}\n","import { Scroller } from '../scroller';\nimport { Process, ProcessRun, ProcessStatus } from '../interfaces/index';\n\nexport default class Start {\n\n  static run(scroller: Scroller, payload?: ProcessRun) {\n    scroller.state.startLoop(payload);\n    scroller.callWorkflow({\n      process: Process.start,\n      status: ProcessStatus.next\n    });\n  }\n\n}\n","import { Scroller } from '../scroller';\nimport { Process, ProcessStatus, Direction } from '../interfaces/index';\n\nexport default class PreFetch {\n\n  static run(scroller: Scroller) {\n    const { fetch } = scroller.state;\n    scroller.state.preFetchPosition = scroller.viewport.scrollPosition;\n    fetch.minIndex = scroller.buffer.minIndex;\n    fetch.averageItemSize = scroller.buffer.averageSize || 0;\n\n    // calculate size before start index\n    PreFetch.setStartDelta(scroller);\n\n    // set first and last indexes to fetch\n    PreFetch.setFetchIndexes(scroller);\n\n    // skip indexes that are in buffer\n    PreFetch.skipBufferedItems(scroller);\n\n    // add indexes if there are too few items to fetch (clip padding)\n    PreFetch.checkFetchPackSize(scroller);\n\n    // set fetch direction\n    PreFetch.setFetchDirection(scroller);\n\n    if (fetch.shouldFetch) {\n      scroller.logger.log(() => `going to fetch ${fetch.count} items started from index ${fetch.index}`);\n    }\n\n    scroller.callWorkflow({\n      process: Process.preFetch,\n      status: scroller.state.fetch.shouldFetch ? ProcessStatus.next : ProcessStatus.done\n    });\n  }\n\n  static setStartDelta(scroller: Scroller) {\n    const { buffer, viewport } = scroller;\n    viewport.startDelta = 0;\n    if (!buffer.hasItemSize) {\n      return;\n    }\n    const minIndex = isFinite(buffer.absMinIndex) ? buffer.absMinIndex : buffer.minIndex;\n    for (let index = minIndex; index < scroller.state.startIndex; index++) {\n      const item = buffer.cache.get(index);\n      viewport.startDelta += item ? item.size : buffer.averageSize;\n    }\n    if (scroller.settings.windowViewport) {\n      viewport.startDelta += viewport.getOffset();\n    }\n    scroller.logger.log(() => `start delta is ${viewport.startDelta}`);\n  }\n\n  static setFetchIndexes(scroller: Scroller) {\n    const { state, viewport } = scroller;\n    const paddingDelta = viewport.getBufferPadding();\n    const relativePosition = state.preFetchPosition - viewport.startDelta;\n    const startPosition = relativePosition - paddingDelta;\n    const endPosition = relativePosition + viewport.getSize() + paddingDelta;\n    const firstIndexPosition =\n      PreFetch.setFirstIndexBuffer(scroller, startPosition);\n    PreFetch.setLastIndexBuffer(scroller, firstIndexPosition, endPosition);\n    scroller.logger.fetch();\n  }\n\n  static setFirstIndexBuffer(scroller: Scroller, startPosition: number): number {\n    const { state, buffer, state: { fetch } } = scroller;\n    let firstIndex = state.startIndex;\n    let firstIndexPosition = 0;\n    if (scroller.state.isInitialLoop) {\n      scroller.logger.log(`skipping fetch backward direction [initial loop]`);\n    } else {\n      const inc = startPosition < 0 ? -1 : 1;\n      let position = firstIndexPosition;\n      let index = firstIndex;\n      while (1) {\n        index += inc;\n        if (index < buffer.absMinIndex) {\n          break;\n        }\n        position += inc * buffer.getSizeByIndex(index);\n        if (inc < 0) {\n          firstIndex = index;\n          firstIndexPosition = position;\n          if (position <= startPosition) {\n            break;\n          }\n        } else {\n          if (position > startPosition) {\n            break;\n          }\n          firstIndex = index;\n          firstIndexPosition = position;\n        }\n      }\n    }\n    fetch.firstIndex = fetch.firstIndexBuffer = Math.max(firstIndex, buffer.absMinIndex);\n    return firstIndexPosition;\n  }\n\n  static setLastIndexBuffer(scroller: Scroller, startPosition: number, endPosition: number) {\n    const { state, buffer, settings } = scroller;\n    let lastIndex;\n    if (!buffer.hasItemSize) {\n      // just to fetch forward bufferSize items if neither averageItemSize nor itemSize are present\n      lastIndex = state.startIndex + settings.bufferSize - 1;\n      scroller.logger.log(`forcing fetch forward direction [no item size]`);\n    } else {\n      let index = <number>state.fetch.firstIndexBuffer;\n      let position = startPosition;\n      let lastIndexPosition;\n      lastIndex = index;\n      while (1) {\n        lastIndex = index;\n        index++;\n        position += buffer.getSizeByIndex(index);\n        lastIndexPosition = position;\n        if (position >= endPosition) {\n          break;\n        }\n        if (index > buffer.absMaxIndex) {\n          break;\n        }\n      }\n    }\n    state.fetch.lastIndex = state.fetch.lastIndexBuffer = Math.min(lastIndex, buffer.absMaxIndex);\n  }\n\n  static skipBufferedItems(scroller: Scroller) {\n    const buffer = scroller.buffer;\n    if (!buffer.size) {\n      return;\n    }\n    const { fetch } = scroller.state;\n    const firstIndex = <number>fetch.firstIndex;\n    const lastIndex = <number>fetch.lastIndex;\n    const packs: Array<Array<number>> = [[]];\n    let p = 0;\n    for (let i = firstIndex; i <= lastIndex; i++) {\n      if (!buffer.get(i)) {\n        packs[p].push(i);\n      } else if (packs[p].length) {\n        packs[++p] = [];\n      }\n    }\n    let pack = packs[0];\n    if (packs[0].length && packs[1] && packs[1].length) {\n      fetch.hasAnotherPack = true;\n      // todo: need to look for biggest pack in visible area\n      // todo: or think about merging two requests in a single Fetch process\n      if (packs[1].length >= packs[0].length) {\n        pack = packs[1];\n      }\n    }\n    fetch.firstIndex = Math.max(pack[0], buffer.absMinIndex);\n    fetch.lastIndex = Math.min(pack[pack.length - 1], buffer.absMaxIndex);\n    if (fetch.firstIndex !== firstIndex || fetch.lastIndex !== lastIndex) {\n      scroller.logger.fetch('after Buffer flushing');\n    }\n  }\n\n  static checkFetchPackSize(scroller: Scroller) {\n    const { buffer, state: { fetch } } = scroller;\n    if (!fetch.shouldFetch) {\n      return;\n    }\n    const firstIndex = <number>fetch.firstIndex;\n    const lastIndex = <number>fetch.lastIndex;\n    const diff = scroller.settings.bufferSize - (lastIndex - firstIndex + 1);\n    if (diff <= 0) {\n      return;\n    }\n    if (!buffer.size || lastIndex > buffer.items[0].$index) { // forward\n      const newLastIndex = Math.min(lastIndex + diff, buffer.absMaxIndex);\n      if (newLastIndex > lastIndex) {\n        fetch.lastIndex = fetch.lastIndexBuffer = newLastIndex;\n      }\n    } else {\n      const newFirstIndex = Math.max(firstIndex - diff, buffer.absMinIndex);\n      if (newFirstIndex < firstIndex) {\n        fetch.firstIndex = fetch.firstIndexBuffer = newFirstIndex;\n      }\n    }\n    if (fetch.firstIndex !== firstIndex || fetch.lastIndex !== lastIndex) {\n      scroller.logger.fetch('after bufferSize adjustment');\n      PreFetch.skipBufferedItems(scroller);\n    }\n  }\n\n  static setFetchDirection(scroller: Scroller) {\n    const { buffer, state: { fetch } } = scroller;\n    if (fetch.lastIndex) {\n      let direction = Direction.forward;\n      if (buffer.size) {\n        direction = fetch.lastIndex < buffer.items[0].$index ? Direction.backward : Direction.forward;\n      }\n      fetch.direction = direction;\n      scroller.logger.log(() => `fetch direction is \"${direction}\"`);\n    }\n  }\n\n}\n","import { Observable, Observer } from 'rxjs';\n\nimport { Scroller } from '../scroller';\nimport { Process, ProcessStatus } from '../interfaces/index';\n\nexport default class Fetch {\n\n  static run(scroller: Scroller) {\n    const result = Fetch.get(scroller);\n    if (typeof result.subscribe !== 'function') {\n      if (!result.isError) {\n        Fetch.success(result.data, scroller);\n      } else {\n        Fetch.fail(result.error, scroller);\n      }\n    } else {\n      scroller.innerLoopSubscriptions.push(\n        result.subscribe(\n          (data: Array<any>) => Fetch.success(data, scroller),\n          (error: any) => Fetch.fail(error, scroller)\n        )\n      );\n    }\n  }\n\n  static success(data: Array<any>, scroller: Scroller) {\n    scroller.logger.log(() => `resolved ${data.length} items ` +\n      `(index = ${scroller.state.fetch.index}, count = ${scroller.state.fetch.count})`);\n    scroller.state.fetch.newItemsData = data;\n\n    scroller.callWorkflow({\n      process: Process.fetch,\n      status: ProcessStatus.next\n    });\n  }\n\n  static fail(error: string, scroller: Scroller) {\n    scroller.callWorkflow({\n      process: Process.fetch,\n      status: ProcessStatus.error,\n      payload: { error }\n    });\n  }\n\n  static get(scroller: Scroller) {\n    const _get = <Function>scroller.datasource.get;\n\n    let immediateData, immediateError;\n    let observer: Observer<any>;\n    const success = (data: any) => {\n      if (!observer) {\n        immediateData = data || null;\n        return;\n      }\n      observer.next(data);\n      observer.complete();\n    };\n    const reject = (error: any) => {\n      if (!observer) {\n        immediateError = error || null;\n        return;\n      }\n      observer.error(error);\n    };\n\n    const result = _get(scroller.state.fetch.index, scroller.state.fetch.count, success, reject);\n    if (result && typeof result.then === 'function') { // DatasourceGetPromise\n      result.then(success, reject);\n    } else if (result && typeof result.subscribe === 'function') { // DatasourceGetObservable\n      return result; // do not wrap observable\n    }\n\n    if (immediateData !== undefined || immediateError !== undefined) {\n      return {\n        data: immediateData,\n        error: immediateError,\n        isError: immediateError !== undefined\n      };\n    }\n\n    return Observable.create((_observer: Observer<any>) => {\n      observer = _observer;\n    });\n  }\n\n}\n","import { Routines } from './domRoutines';\nimport { Direction } from '../interfaces/index';\n\nexport class Item {\n  $index: number;\n  data: any;\n  nodeId: string;\n  routines: Routines;\n\n  element: HTMLElement;\n  size: number;\n  invisible: boolean;\n  toRemove: boolean;\n  removeDirection: Direction;\n\n  constructor($index: number, data: any, routines: Routines) {\n    this.$index = $index;\n    this.data = data;\n    this.nodeId = String($index);\n    this.routines = routines;\n    this.invisible = true;\n  }\n\n  setSize() {\n    this.size = this.routines.getSize(this.element);\n  }\n\n  hide() {\n    if (this.element) {\n      this.routines.hideElement(this.element);\n    }\n  }\n}\n","import { Scroller } from '../scroller';\nimport { Item } from '../classes/item';\nimport { Process, ProcessStatus } from '../interfaces/index';\n\nexport default class PostFetch {\n\n  static run(scroller: Scroller) {\n    if (PostFetch.setItems(scroller)) {\n      PostFetch.setBufferLimits(scroller);\n      scroller.callWorkflow({\n        process: Process.postFetch,\n        status: scroller.state.fetch.hasNewItems ? ProcessStatus.next : ProcessStatus.done\n      });\n    } else {\n      scroller.callWorkflow({\n        process: Process.postFetch,\n        status: ProcessStatus.error,\n        payload: { error: 'Can\\'t set buffer items' }\n      });\n    }\n  }\n\n  static setBufferLimits(scroller: Scroller) {\n    const { buffer, state: { fetch: { firstIndex, lastIndex, items } } } = scroller;\n    if (!items.length) {\n      if (<number>lastIndex < buffer.minIndex) {\n        buffer.absMinIndex = buffer.minIndex;\n      }\n      if (<number>firstIndex > buffer.maxIndex) {\n        buffer.absMaxIndex = buffer.maxIndex;\n      }\n    } else {\n      const last = items.length - 1;\n      if (<number>firstIndex < items[0].$index) {\n        buffer.absMinIndex = items[0].$index;\n      }\n      if (<number>lastIndex > items[last].$index) {\n        buffer.absMaxIndex = items[last].$index;\n      }\n    }\n  }\n\n  static setItems(scroller: Scroller): boolean {\n    const { buffer, state: { fetch } } = scroller;\n    const items = fetch.newItemsData;\n    if (!items || !items.length) { // empty result\n      return true;\n    }\n    // eof/bof case, need to shift fetch index if bof\n    let fetchIndex = <number>fetch.index;\n    if (items.length < fetch.count) {\n      if (scroller.state.isInitialLoop) {\n        // let's treat initial poor fetch as startIndex-bof\n        fetchIndex = scroller.state.startIndex;\n      } else if (<number>fetch.firstIndex < buffer.minIndex) { // normal bof\n        fetchIndex = buffer.minIndex - items.length;\n      }\n    }\n    fetch.items = items.map((item, index: number) =>\n      new Item(fetchIndex + index, item, scroller.routines)\n    );\n    fetch.isPrepend = !!buffer.items.length && buffer.items[0].$index > fetch.items[fetch.items.length - 1].$index;\n    return buffer.setItems(fetch.items);\n  }\n\n}\n","import { Scroller } from '../scroller';\nimport { Process, ProcessStatus } from '../interfaces/index';\n\nexport default class Render {\n\n  static run(scroller: Scroller) {\n    scroller.logger.stat('before new items render');\n    scroller.innerLoopSubscriptions.push(\n      scroller.bindData().subscribe(() => {\n        if (Render.processElements(scroller)) {\n          scroller.callWorkflow({\n            process: Process.render,\n            status: ProcessStatus.next\n          });\n        } else {\n          scroller.callWorkflow({\n            process: Process.render,\n            status: ProcessStatus.error,\n            payload: { error: 'Can\\'t associate item with element' }\n          });\n        }\n      })\n    );\n  }\n\n  static processElements(scroller: Scroller) {\n    const { state, state: { fetch, fetch: { items } }, viewport, buffer } = scroller;\n    const itemsLength = items.length;\n    const scrollBeforeRender = scroller.settings.windowViewport ? scroller.viewport.scrollPosition : 0;\n    state.sizeBeforeRender = viewport.getScrollableSize();\n    state.fwdPaddingBeforeRender = viewport.paddings.forward.size;\n    for (let j = 0; j < itemsLength; j++) {\n      const item = items[j];\n      const element = viewport.element.querySelector(`[data-sid=\"${item.nodeId}\"]`);\n      if (!element) {\n        return false;\n      }\n      item.element = <HTMLElement>element;\n      item.element.style.left = '';\n      item.element.style.position = '';\n      item.invisible = false;\n      item.setSize();\n      buffer.cache.add(item);\n      if (item.$index < fetch.minIndex) {\n        fetch.negativeSize += item.size;\n      }\n    }\n    buffer.checkAverageSize();\n    if (scroller.settings.windowViewport && fetch.isPrepend) {\n      Render.processWindowScrollBackJump(scroller, scrollBeforeRender);\n    }\n    scroller.logger.stat('after new items render');\n    return true;\n  }\n\n  static processWindowScrollBackJump(scroller: Scroller, scrollBeforeRender: number) {\n    const { state, state: { scrollState: { window } }, viewport } = scroller;\n    // if new items have been rendered in the area that is before current scroll position\n    // then this position will be updated silently in case of entire window scrollable\n    // so we need to remember the delta and to update scroll position manually right after it is changed silently\n    const inc = scrollBeforeRender >= viewport.paddings.backward.size ? 1 : -1;\n    const delta = inc * Math.abs(viewport.getScrollableSize() - state.sizeBeforeRender);\n    const positionToUpdate = scrollBeforeRender - delta;\n    if (delta && positionToUpdate > 0) {\n      window.positionToUpdate = positionToUpdate;\n      window.delta = delta;\n      scroller.logger.log(() => {\n        const token = delta < 0 ? 'reduced' : 'increased';\n        return [`next scroll position (if ${positionToUpdate}) should be ${token} by`, Math.abs(delta)];\n      });\n    }\n  }\n\n}\n","import { Scroller } from '../scroller';\r\nimport { Direction, Process, ProcessStatus } from '../interfaces/index';\r\n\r\nexport default class Adjust {\r\n\r\n  static MAX_SCROLL_ADJUSTMENTS_COUNT = 10;\r\n\r\n  static run(scroller: Scroller) {\r\n    scroller.state.preAdjustPosition = scroller.viewport.scrollPosition;\r\n\r\n    // padding-elements adjustments\r\n    const setPaddingsResult =\r\n      Adjust.setPaddings(scroller);\r\n\r\n    if (setPaddingsResult === false) {\r\n      scroller.callWorkflow({\r\n        process: Process.adjust,\r\n        status: ProcessStatus.error,\r\n        payload: { error: 'Can\\'t get visible item' }\r\n      });\r\n      return;\r\n    }\r\n\r\n    // scroll position adjustments\r\n    Adjust.fixScrollPosition(scroller, <number>setPaddingsResult);\r\n\r\n    scroller.callWorkflow({\r\n      process: Process.adjust,\r\n      status: ProcessStatus.done\r\n    });\r\n  }\r\n\r\n  static setPaddings(scroller: Scroller): boolean | number {\r\n    const { viewport, buffer, state: { fetch } } = scroller;\r\n    const firstItem = buffer.getFirstVisibleItem();\r\n    const lastItem = buffer.getLastVisibleItem();\r\n    if (!firstItem || !lastItem) {\r\n      return false;\r\n    }\r\n    const forwardPadding = viewport.paddings.forward;\r\n    const backwardPadding = viewport.paddings.backward;\r\n    const firstIndex = firstItem.$index;\r\n    const lastIndex = lastItem.$index;\r\n    const minIndex = isFinite(buffer.absMinIndex) ? buffer.absMinIndex : buffer.minIndex;\r\n    const maxIndex = isFinite(buffer.absMaxIndex) ? buffer.absMaxIndex : buffer.maxIndex;\r\n    const hasAverageItemSizeChanged = buffer.averageSize !== fetch.averageItemSize;\r\n    let index, bwdSize = 0, fwdSize = 0, bwdPaddingAverageSizeItemsCount = 0;\r\n\r\n    // new backward padding\r\n    for (index = minIndex; index < firstIndex; index++) {\r\n      const item = buffer.cache.get(index);\r\n      bwdSize += item ? item.size : buffer.cache.averageSize;\r\n      if (hasAverageItemSizeChanged) {\r\n        bwdPaddingAverageSizeItemsCount += !item ? 1 : 0;\r\n      }\r\n    }\r\n    if (hasAverageItemSizeChanged) {\r\n      for (index = firstIndex; index < <number>fetch.firstIndexBuffer; index++) {\r\n        bwdPaddingAverageSizeItemsCount += !buffer.cache.get(index) ? 1 : 0;\r\n      }\r\n    }\r\n\r\n    // new forward padding\r\n    for (index = lastIndex + 1; index <= maxIndex; index++) {\r\n      const item = buffer.cache.get(index);\r\n      fwdSize += item ? item.size : buffer.cache.averageSize;\r\n    }\r\n    const fwdPaddingDiff = forwardPadding.size - fwdSize;\r\n    const viewportSizeDiff = viewport.getSize() - viewport.getScrollableSize() + fwdPaddingDiff;\r\n    if (viewportSizeDiff > 0) {\r\n      fwdSize += viewportSizeDiff;\r\n      scroller.logger.log(`forward padding will be increased by ${viewportSizeDiff} to fill the viewport`);\r\n    }\r\n\r\n    forwardPadding.size = fwdSize;\r\n    backwardPadding.size = bwdSize;\r\n\r\n    scroller.logger.stat('after paddings adjustments');\r\n    return bwdPaddingAverageSizeItemsCount;\r\n  }\r\n\r\n  static fixScrollPosition(scroller: Scroller, bwdPaddingAverageSizeItemsCount: number) {\r\n    const { viewport, buffer, state, state: { fetch, fetch: { items, negativeSize } } } = scroller;\r\n\r\n    if (scroller.settings.windowViewport) {\r\n      const newPosition = viewport.scrollPosition;\r\n      const posDiff = state.preAdjustPosition - newPosition;\r\n      if (posDiff) {\r\n        const winState = state.scrollState.window;\r\n        if (newPosition === winState.positionToUpdate) {\r\n          winState.reset();\r\n          state.syntheticScroll.readyToReset = false;\r\n          scroller.logger.log(() => `process window scroll preventive: sum(${newPosition}, ${posDiff})`);\r\n          Adjust.setScroll(scroller, posDiff);\r\n          scroller.logger.stat('after scroll position adjustment (window)');\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n    // if backward padding has been changed due to average item size change\r\n    const hasAverageItemSizeChanged = buffer.averageSize !== fetch.averageItemSize;\r\n    const bwdAverageItemsCountDiff = state.bwdPaddingAverageSizeItemsCount - bwdPaddingAverageSizeItemsCount;\r\n    const hasBwdParamsChanged = bwdPaddingAverageSizeItemsCount > 0 || bwdAverageItemsCountDiff > 0;\r\n    if (hasAverageItemSizeChanged && hasBwdParamsChanged) {\r\n      const _bwdPaddingAverageSize = bwdPaddingAverageSizeItemsCount * buffer.averageSize;\r\n      const bwdPaddingAverageSize = bwdPaddingAverageSizeItemsCount * fetch.averageItemSize;\r\n      const bwdPaddingAverageSizeDiff = _bwdPaddingAverageSize - bwdPaddingAverageSize;\r\n      const bwdAverageItemsSizeDiff = bwdAverageItemsCountDiff * fetch.averageItemSize;\r\n      const positionDiff = bwdPaddingAverageSizeDiff - bwdAverageItemsSizeDiff;\r\n      if (positionDiff) {\r\n        Adjust.setScroll(scroller, positionDiff);\r\n        scroller.logger.stat('after scroll position adjustment (average)');\r\n      }\r\n      state.bwdPaddingAverageSizeItemsCount = bwdPaddingAverageSizeItemsCount;\r\n    }\r\n\r\n    // if scrollable area size padding forward size have not been changed during this cycle\r\n    if (state.sizeBeforeRender === viewport.getScrollableSize() &&\r\n      viewport.paddings.forward.size === state.fwdPaddingBeforeRender) {\r\n      return;\r\n    }\r\n    // no negative area items\r\n    if (items[0].$index >= fetch.minIndex) {\r\n      return;\r\n    }\r\n\r\n    if (negativeSize > 0) {\r\n      Adjust.setScroll(scroller, negativeSize);\r\n    } else if (negativeSize < 0) {\r\n      viewport.paddings.forward.size -= negativeSize;\r\n      viewport.scrollPosition -= negativeSize;\r\n    }\r\n    scroller.logger.stat('after scroll position adjustment (negative)');\r\n  }\r\n\r\n  static setScroll(scroller: Scroller, delta: number) {\r\n    const { viewport } = scroller;\r\n    const forwardPadding = viewport.paddings[Direction.forward];\r\n    const oldPosition = viewport.scrollPosition;\r\n    const newPosition = Math.round(oldPosition + delta);\r\n    for (let i = 0; i < Adjust.MAX_SCROLL_ADJUSTMENTS_COUNT; i++) {\r\n      viewport.scrollPosition = newPosition;\r\n      const positionDiff = newPosition - viewport.scrollPosition;\r\n      if (positionDiff > 0) {\r\n        forwardPadding.size += positionDiff;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n","import { Scroller } from '../scroller';\r\nimport { Direction, Process, ProcessStatus } from '../interfaces/index';\r\n\r\nexport default class Clip {\r\n\r\n  static run(scroller: Scroller) {\r\n    Clip.prepareClip(scroller);\r\n\r\n    if (scroller.state.clip) {\r\n      Clip.doClip(scroller);\r\n    }\r\n\r\n    scroller.callWorkflow({\r\n      process: Process.clip,\r\n      status: ProcessStatus.next\r\n    });\r\n  }\r\n\r\n  static prepareClip(scroller: Scroller) {\r\n    const { buffer, state, state: { fetch, fetch: { direction } } } = scroller;\r\n    if (!buffer.size) {\r\n      return;\r\n    }\r\n    if (state.isInitialWorkflowCycle && !state.scrollState.scroll) {\r\n      scroller.logger.log(`skipping clip [initial cycle, no scroll]`);\r\n      return;\r\n    }\r\n    const firstIndex = <number>fetch.firstIndexBuffer;\r\n    const lastIndex = <number>fetch.lastIndexBuffer;\r\n    scroller.logger.log(() =>\r\n      `looking for ${direction ? 'anti-' + direction + ' ' : ''}items ` +\r\n      `that are out of [${firstIndex}..${lastIndex}] range`);\r\n    if (!direction || direction === Direction.forward) {\r\n      if (firstIndex - 1 >= buffer.absMinIndex) {\r\n        Clip.prepareClipByDirection(scroller, Direction.forward, firstIndex);\r\n      }\r\n    }\r\n    if (!direction || direction === Direction.backward) {\r\n      if (lastIndex + 1 <= buffer.absMaxIndex) {\r\n        Clip.prepareClipByDirection(scroller, Direction.backward, lastIndex);\r\n      }\r\n    }\r\n    return;\r\n  }\r\n\r\n  static prepareClipByDirection(scroller: Scroller, direction: Direction, edgeIndex: number) {\r\n    const forward = direction === Direction.forward;\r\n    scroller.buffer.items.forEach(item => {\r\n      if (\r\n        (forward && item.$index < edgeIndex) ||\r\n        (!forward && item.$index > edgeIndex)\r\n      ) {\r\n        item.toRemove = true;\r\n        item.removeDirection = direction;\r\n        scroller.state.clip = true;\r\n      }\r\n    });\r\n  }\r\n\r\n  static doClip(scroller: Scroller) {\r\n    const { buffer, viewport: { paddings }, logger } = scroller;\r\n    const clipped: Array<number> = [];\r\n    const size = { backward: 0, forward: 0 };\r\n    scroller.state.clipCall++;\r\n    logger.stat(`before clip (${scroller.state.clipCall})`);\r\n    buffer.items = buffer.items.filter(item => {\r\n      if (item.toRemove) {\r\n        size[item.removeDirection] += item.size;\r\n        item.hide();\r\n        clipped.push(item.$index);\r\n        return false;\r\n      }\r\n      return true;\r\n    });\r\n    if (size.backward) {\r\n      paddings.forward.size += size.backward;\r\n    }\r\n    if (size.forward) {\r\n      paddings.backward.size += size.forward;\r\n    }\r\n    logger.log(() => [\r\n      `clipped ${clipped.length} items` +\r\n      (size.backward ? `, +${size.backward} fwd px,` : '') +\r\n      (size.forward ? `, +${size.forward} bwd px,` : ''),\r\n      `range: [${clipped[0]}..${clipped[clipped.length - 1]}]`\r\n    ]);\r\n    logger.stat('after clip');\r\n  }\r\n\r\n}\r\n","import { Scroller } from '../scroller';\nimport { Process, ProcessStatus, ProcessRun, Direction } from '../interfaces/index';\nimport { itemAdapterEmpty } from '../classes/adapter';\n\nexport default class End {\n\n  static run(scroller: Scroller, error?: any) {\n    // finalize current workflow loop\n    End.endWorkflowLoop(scroller);\n\n    // set out params, accessible via Adapter\n    End.calculateParams(scroller);\n\n    // what next? done?\n    const next = End.getNext(scroller, error);\n\n    // need to apply Buffer.items changes if clip\n    if (scroller.state.clip) {\n      scroller.runChangeDetector();\n    }\n\n    // stub method call\n    scroller.finalize();\n\n    // continue the Workflow synchronously; current cycle could be finilized immediately\n    scroller.callWorkflow({\n      process: Process.end,\n      status: next ? ProcessStatus.next : ProcessStatus.done,\n      payload: next || { empty: true }\n    });\n\n    // if the Workflow isn't finilized, it may freeze for no more than settings.throttle ms\n    if (scroller.state.workflowPending && !scroller.state.loopPending) {\n      // continue the Workflow asynchronously\n      End.continueWorkflowByTimer(scroller);\n    }\n  }\n\n  static endWorkflowLoop(scroller: Scroller) {\n    const { state } = scroller;\n    state.endLoop();\n    state.lastPosition = scroller.viewport.scrollPosition;\n    scroller.purgeInnerLoopSubscriptions();\n  }\n\n  static calculateParams(scroller: Scroller) {\n    const { items } = scroller.buffer;\n\n    // first visible item\n    if (scroller.state.firstVisibleWanted) {\n      const viewportBackwardEdge = scroller.viewport.getEdge(Direction.backward);\n      const firstItem = items.find(item =>\n        scroller.viewport.getElementEdge(item.element, Direction.forward) > viewportBackwardEdge\n      );\n      scroller.state.firstVisibleItem = firstItem ? {\n        $index: firstItem.$index,\n        data: firstItem.data,\n        element: firstItem.element\n      } : itemAdapterEmpty;\n    }\n\n    // last visible item\n    if (scroller.state.lastVisibleWanted) {\n      const viewportForwardEdge = scroller.viewport.getEdge(Direction.forward);\n      let lastItem = null;\n      for (let i = items.length - 1; i >= 0; i--) {\n        const edge = scroller.viewport.getElementEdge(items[i].element, Direction.backward);\n        if (edge < viewportForwardEdge) {\n          lastItem = items[i];\n          break;\n        }\n      }\n      scroller.state.lastVisibleItem = lastItem ? {\n        $index: lastItem.$index,\n        data: lastItem.data,\n        element: lastItem.element\n      } : itemAdapterEmpty;\n    }\n  }\n\n  static getNext(scroller: Scroller, error?: any): ProcessRun | null {\n    const { state: { fetch, scrollState } } = scroller;\n    let next: ProcessRun | null = null;\n    if (!error) {\n      if (fetch.hasNewItems) {\n        next = { scroll: false };\n      } else if (fetch.hasAnotherPack) {\n        next = { scroll: false };\n      }\n      if (scrollState.keepScroll) {\n        next = { scroll: true, keepScroll: true };\n      }\n    }\n    return next;\n  }\n\n  static continueWorkflowByTimer(scroller: Scroller) {\n    const { state, state: { workflowCycleCount, innerLoopCount } } = scroller;\n    scroller.logger.log(() => `setting Workflow timer (${workflowCycleCount}-${innerLoopCount})`);\n    state.scrollState.workflowTimer = <any>setTimeout(() => {\n      // if the WF isn't finilized while the old sub-cycle is done and there's no new sub-cycle\n      if (state.workflowPending && !state.loopPending && innerLoopCount === state.innerLoopCount) {\n        scroller.callWorkflow({\n          process: Process.end,\n          status: ProcessStatus.next,\n          payload: { scroll: true, byTimer: true }\n        });\n      }\n    }, scroller.settings.throttle);\n  }\n\n}\n","import { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { UiScrollComponent } from '../ui-scroll.component';\nimport { Scroller } from './scroller';\nimport { Process, ProcessStatus as Status, ProcessSubject } from './interfaces/index';\nimport { Init, Scroll, Reload, Start, PreFetch, Fetch, PostFetch, Render, Clip, Adjust, End } from './processes/index';\n\nexport class Workflow {\n\n  scroller: Scroller;\n  process$: BehaviorSubject<ProcessSubject>;\n  cyclesDone: number;\n\n  readonly context: UiScrollComponent;\n  readonly onScrollHandler: EventListener;\n  private itemsSubscription: Subscription;\n  private workflowSubscription: Subscription;\n  private scrollEventOptions: any;\n\n  constructor(context: UiScrollComponent) {\n    this.context = context;\n    this.scroller = new Scroller(this.context, this.callWorkflow.bind(this));\n    this.process$ = new BehaviorSubject(<ProcessSubject>{\n      process: Process.init,\n      status: Status.start\n    });\n    this.cyclesDone = 0;\n    this.onScrollHandler = event => Scroll.run(this.scroller, { event });\n\n    if (this.scroller.settings.initializeDelay) {\n      setTimeout(() => this.init(), this.scroller.settings.initializeDelay);\n    } else {\n      this.init();\n    }\n  }\n\n  init() {\n    this.scroller.init();\n    this.scroller.logger.stat('initialization');\n    this.initListeners();\n  }\n\n  initListeners() {\n    const scroller = this.scroller;\n    scroller.logger.log(() => `uiScroll Workflow listeners are being initialized`);\n    this.itemsSubscription = scroller.buffer.$items.subscribe(items => this.context.items = items);\n    this.workflowSubscription = this.process$.subscribe(this.process.bind(this));\n    this.initScrollEventListener();\n  }\n\n  initScrollEventListener() {\n    let passiveSupported = false;\n    try {\n      window.addEventListener(\n        'test', <EventListenerOrEventListenerObject>{}, Object.defineProperty({}, 'passive', {\n          get: () => passiveSupported = true\n        })\n      );\n    } catch (err) {\n    }\n    this.scrollEventOptions = passiveSupported ? { passive: false } : false;\n    this.scroller.viewport.scrollEventElement.addEventListener(\n      'scroll', this.onScrollHandler, this.scrollEventOptions\n    );\n  }\n\n  detachScrollEventListener() {\n    this.scroller.viewport.scrollEventElement.removeEventListener(\n      'scroll', this.onScrollHandler, this.scrollEventOptions\n    );\n  }\n\n  process(data: ProcessSubject) {\n    const scroller = this.scroller;\n    const { status, payload } = data;\n    this.scroller.logger.logProcess(data);\n    if (status === Status.error) {\n      End.run(scroller, payload);\n      return;\n    }\n    switch (data.process) {\n      case Process.init:\n        if (status === Status.start) {\n          Init.run(scroller);\n        }\n        if (status === Status.next) {\n          Start.run(scroller, payload);\n        }\n        break;\n      case Process.reload:\n        if (status === Status.start) {\n          Reload.run(scroller, payload);\n        }\n        if (status === Status.next) {\n          Init.run(scroller);\n        }\n        break;\n      case Process.scroll:\n        if (status === Status.next) {\n          if (!(payload && payload.keepScroll)) {\n            Init.run(scroller, payload);\n          } else {\n            Start.run(scroller, payload);\n          }\n        }\n        break;\n      case Process.start:\n        if (status === Status.next) {\n          PreFetch.run(scroller);\n        }\n        break;\n      case Process.preFetch:\n        if (status === Status.done) {\n          End.run(scroller);\n        }\n        if (status === Status.next) {\n          Fetch.run(scroller);\n        }\n        break;\n      case Process.fetch:\n        if (status === Status.next) {\n          PostFetch.run(scroller);\n        }\n        break;\n      case Process.postFetch:\n        if (status === Status.next) {\n          Render.run(scroller);\n        }\n        if (status === Status.done) {\n          End.run(scroller);\n        }\n        break;\n      case Process.render:\n        if (status === Status.next) {\n          if (scroller.settings.infinite) {\n            Adjust.run(scroller);\n          } else {\n            Clip.run(scroller);\n          }\n        }\n        break;\n      case Process.clip:\n        if (status === Status.next) {\n          Adjust.run(scroller);\n        }\n        break;\n      case Process.adjust:\n        if (status === Status.done) {\n          End.run(scroller);\n        }\n        break;\n      case Process.end:\n        if (status === Status.next) {\n          if (payload && payload.keepScroll) {\n            Scroll.run(scroller);\n          } else {\n            Start.run(scroller, payload);\n          }\n        }\n        if (status === Status.done) {\n          this.done();\n        }\n        break;\n    }\n  }\n\n  callWorkflow(processSubject: ProcessSubject) {\n    this.process$.next(processSubject);\n  }\n\n  done() {\n    const { state } = this.scroller;\n    this.cyclesDone++;\n    state.workflowCycleCount = this.cyclesDone + 1;\n    state.isInitialWorkflowCycle = false;\n    state.workflowPending = false;\n    if (state.scrollState.scrollTimer === null) {\n      state.isLoading = false;\n    }\n    this.finalize();\n  }\n\n  dispose() {\n    this.detachScrollEventListener();\n    this.process$.complete();\n    this.workflowSubscription.unsubscribe();\n    this.itemsSubscription.unsubscribe();\n    this.scroller.dispose();\n  }\n\n  finalize() {\n  }\n\n}\n","import {\n  Component, OnInit, OnDestroy,\n  TemplateRef, ElementRef,\n  ChangeDetectionStrategy, ChangeDetectorRef\n} from '@angular/core';\n\nimport { Workflow } from './component/workflow';\nimport { Datasource as IDatasource } from './component/interfaces/index';\nimport { Datasource } from './component/classes/datasource';\nimport { Item } from './component/classes/item';\n\n@Component({\n  selector: '[ui-scroll]',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  template: `<div data-padding-backward></div><div\n  *ngFor=\"let item of items\"\n  [attr.data-sid]=\"item.nodeId\"\n  [style.position]=\"item.invisible ? 'fixed' : null\"\n  [style.left]=\"item.invisible ? '-99999px' : null\"\n><ng-template\n  [ngTemplateOutlet]=\"template\"\n  [ngTemplateOutletContext]=\"{\n    $implicit: item.data,\n    index: item.$index,\n    odd: item.$index % 2,\n    even: !(item.$index % 2)\n }\"\n></ng-template></div><div data-padding-forward></div>`\n})\nexport class UiScrollComponent implements OnInit, OnDestroy {\n\n  // come from the directive\n  public version: string;\n  public template: TemplateRef<any>;\n  public datasource: IDatasource | Datasource;\n\n  // use in the template\n  public items: Array<Item>;\n\n  // Component-Workflow integration\n  public workflow: Workflow;\n\n  constructor(\n    public changeDetector: ChangeDetectorRef,\n    public elementRef: ElementRef\n  ) {\n  }\n\n  ngOnInit() {\n    this.workflow = new Workflow(this);\n  }\n\n  ngOnDestroy() {\n    this.workflow.dispose();\n  }\n}\n","export default '1.0.1';\n","import { Directive, Input, TemplateRef, ViewContainerRef, ComponentFactoryResolver, OnInit } from '@angular/core';\n\nimport version from './ui-scroll.version';\nimport { UiScrollComponent } from './ui-scroll.component';\nimport { Datasource } from './component/interfaces/datasource';\n\n@Directive({ selector: '[uiScroll][uiScrollOf]' })\nexport class UiScrollDirective implements OnInit {\n  private version: string;\n  private datasource: Datasource;\n\n  constructor(\n    private templateRef: TemplateRef<any>,\n    private viewContainer: ViewContainerRef,\n    private resolver: ComponentFactoryResolver\n  ) {\n  }\n\n  @Input() set uiScrollOf(datasource: Datasource) {\n    this.datasource = datasource;\n  }\n\n  ngOnInit() {\n    const templateView = this.templateRef.createEmbeddedView({});\n    const compFactory = this.resolver.resolveComponentFactory(UiScrollComponent);\n    const componentRef = this.viewContainer.createComponent(\n      compFactory, undefined, this.viewContainer.injector, [templateView.rootNodes]\n    );\n    componentRef.instance.datasource = this.datasource;\n    componentRef.instance.template = this.templateRef;\n    componentRef.instance.version = version;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { UiScrollComponent } from './ui-scroll.component';\nimport { UiScrollDirective } from './ui-scroll.directive';\n\n@NgModule({\n  declarations: [\n    UiScrollComponent,\n    UiScrollDirective\n  ],\n  imports: [CommonModule],\n  entryComponents: [UiScrollComponent],\n  exports: [UiScrollDirective],\n  providers: []\n})\nexport class UiScrollModule { }\n"],"names":["observableOf","Status"],"mappings":"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"}