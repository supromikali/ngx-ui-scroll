{"version":3,"file":"logger.js","sourceRoot":"","sources":["../../../package/src/component/classes/logger.ts"],"names":[],"mappings":"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","sourcesContent":["import { Scroller } from '../scroller';\nimport { Process, ProcessRun, ProcessStatus as Status, ProcessSubject } from '../interfaces/index';\n\nexport class Logger {\n\n  readonly debug: boolean;\n  readonly immediateLog: boolean;\n  readonly logTime: boolean;\n  readonly getTime: Function;\n  readonly getStat: Function;\n  readonly getFetchRange: Function;\n  readonly getInnerLoopCount: Function;\n  readonly getWorkflowCycleData: Function;\n  private logs: Array<any> = [];\n\n  constructor(scroller: Scroller) {\n    const { settings } = scroller;\n    this.debug = settings.debug;\n    this.immediateLog = settings.immediateLog;\n    this.logTime = settings.logTime;\n    this.getTime = (): string =>\n      scroller.state && ` // time: ${scroller.state.time}`;\n    this.getStat = (): string => {\n      const { buffer, viewport } = scroller;\n      const first = buffer.getFirstVisibleItem();\n      const last = buffer.getLastVisibleItem();\n      return 'pos: ' + viewport.scrollPosition + ', ' +\n        'size: ' + viewport.getScrollableSize() + ', ' +\n        'bwd_p: ' + viewport.paddings.backward.size + ', ' +\n        'fwd_p: ' + viewport.paddings.forward.size + ', ' +\n        'aver: ' + (buffer.hasItemSize ? buffer.averageSize : 'no') + ', ' +\n        'items: ' + buffer.getVisibleItemsCount() + ', ' +\n        'range: ' + (first && last ? `[${first.$index}..${last.$index}]` : 'no');\n    };\n    this.getFetchRange = (): string => {\n      const { firstIndex, lastIndex } = scroller.state.fetch;\n      const hasInterval = firstIndex !== null && lastIndex !== null && !isNaN(firstIndex) && !isNaN(lastIndex);\n      return hasInterval ? `[${firstIndex}..${lastIndex}]` : 'no';\n    };\n    this.getInnerLoopCount = (): number => scroller.state.innerLoopCount;\n    this.getWorkflowCycleData = (more: boolean): string =>\n      `${scroller.settings.instanceIndex}-${scroller.state.workflowCycleCount}` + (more ? '-' : '');\n    this.log(() => `uiScroll Workflow has been started (v${scroller.version}, instance ${settings.instanceIndex})`);\n  }\n\n  object(str: string, obj: any, stringify?: boolean) {\n    this.log(() => [\n      str,\n      stringify\n        ? JSON.stringify(obj)\n          .replace(/\"/g, '')\n          .replace(/(\\{|\\:|\\,)/g, '$1 ')\n        : obj\n    ]);\n  }\n\n  stat(str?: string) {\n    if (this.debug) {\n      const logStyles = ['color: #888; border: dashed #888 0; border-bottom-width: 0px', 'color: #000; border-width: 0'];\n      this.log(() => ['%cstat' + (str ? ` ${str}` : '') + ',%c ' + this.getStat(), ...logStyles]);\n    }\n  }\n\n  fetch(str?: string) {\n    if (this.debug) {\n      const _text = 'fetch interval' + (str ? ` ${str}` : '');\n      const logStyles = ['color: #888', 'color: #000'];\n      this.log(() => [`%c${_text}: %c${this.getFetchRange()}`, ...logStyles]);\n    }\n  }\n\n  logProcess(data: ProcessSubject) {\n    if (!this.debug) {\n      return;\n    }\n    const { process, status } = data;\n    const payload: ProcessRun = data.payload || { empty: true };\n\n    // standard process log\n    const processLog = `process ${process}, %c${status}%c` + (!payload.empty ? ',' : '');\n    const styles = [status === Status.error ? 'color: #cc0000;' : '', 'color: #000000;'];\n    this.log(() => [processLog, ...styles, ...(!payload.empty ? [payload] : [])]);\n\n    // inner loop start-end log\n    const workflowCycleData = this.getWorkflowCycleData(true);\n    const loopCount = this.getInnerLoopCount();\n    const loopLog: string[] = [];\n    if (\n      process === Process.init && status === Status.next ||\n      process === Process.scroll && status === Status.next && payload.keepScroll ||\n      process === Process.end && status === Status.next && payload.byTimer\n    ) {\n      loopLog.push(`%c---=== loop ${workflowCycleData + (loopCount + 1)} start`);\n    } else if (\n      process === Process.end && !payload.byTimer\n    ) {\n      loopLog.push(`%c---=== loop ${workflowCycleData + loopCount} done`);\n      if (status === Status.next && !(payload.keepScroll)) {\n        loopLog[0] += `, loop ${workflowCycleData + (loopCount + 1)} start`;\n      }\n    }\n    if (loopLog.length) {\n      this.log(() => [...loopLog, 'color: #006600;']);\n    }\n\n    // workflow cycle start log\n    if (\n      process === Process.init && status === Status.start ||\n      process === Process.reload && status === Status.next ||\n      process === Process.scroll && status === Status.next && !(payload.keepScroll)\n    ) {\n      const logData = this.getWorkflowCycleData(false);\n      const logStyles = 'color: #0000aa; border: solid black 1px; border-width: 1px 0 0 1px; margin-left: -2px';\n      this.log(() => [`%c   ~~~ WF Cycle ${logData} STARTED ~~~  `, logStyles]);\n    }\n\n    // workflow run end log\n    if (process === Process.end && status === Status.done) {\n      const logData = this.getWorkflowCycleData(false);\n      const logStyles = 'color: #0000aa; border: solid #555 1px; border-width: 0 0 1px 1px; margin-left: -2px';\n      this.log(() => [`%c   ~~~ WF Cycle ${logData} FINALIZED ~~~  `, logStyles]);\n    }\n  }\n\n  log(...args: Array<any>) {\n    if (this.debug) {\n      if (typeof args[0] === 'function') {\n        args = args[0]();\n        if (!Array.isArray(args)) {\n          args = [args];\n        }\n      }\n      if (args.every(item => item === undefined)) {\n        return;\n      }\n      if (this.logTime) {\n        args = [...args, this.getTime()];\n      }\n      if (this.immediateLog) {\n        console.log.apply(this, args);\n      } else {\n        this.logs.push(args);\n      }\n    }\n  }\n\n  logForce(...args: Array<any>) {\n    if (this.debug) {\n      if (!this.immediateLog && this.logs.length) {\n        this.logs.forEach(logArgs => console.log.apply(this, logArgs));\n        this.logs = [];\n      }\n      if (args.length) {\n        console.log.apply(this, args);\n      }\n    }\n  }\n}\n"]}