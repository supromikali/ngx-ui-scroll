{"version":3,"file":"adapter.js","sourceRoot":"","sources":["../../../package/src/component/classes/adapter.ts"],"names":[],"mappings":"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","sourcesContent":["import { BehaviorSubject, Observable, Observer, of as observableOf } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\n\r\nimport { Adapter as IAdapter, Process, ProcessSubject, ProcessStatus, ItemAdapter } from '../interfaces/index';\r\nimport { Scroller } from '../scroller';\r\n\r\nconst getIsInitialized = (adapter: Adapter): Observable<boolean> =>\r\n  Observable.create((observer: Observer<boolean>) => {\r\n    const intervalId = setInterval(() => {\r\n      if (adapter && adapter.init) {\r\n        clearInterval(intervalId);\r\n        observer.next(true);\r\n        observer.complete();\r\n      }\r\n    }, 25);\r\n  });\r\n\r\nconst getInitializedSubject = (adapter: Adapter, method: Function): BehaviorSubject<any> => {\r\n  return adapter.init ? method() :\r\n    adapter.init$\r\n      .pipe(switchMap(() =>\r\n        method()\r\n      ));\r\n};\r\n\r\nexport const itemAdapterEmpty = <ItemAdapter> {\r\n  data: {},\r\n  element: {}\r\n};\r\n\r\nexport const generateMockAdapter = (): IAdapter => (\r\n  <IAdapter> {\r\n    version: null,\r\n    init: false,\r\n    init$: observableOf(false),\r\n    isLoading: false,\r\n    isLoading$: new BehaviorSubject<boolean>(false),\r\n    cyclePending: false,\r\n    cyclePending$: new BehaviorSubject<boolean>(false),\r\n    loopPending: false,\r\n    loopPending$: new BehaviorSubject<boolean>(false),\r\n    firstVisible: itemAdapterEmpty,\r\n    firstVisible$: new BehaviorSubject<ItemAdapter>(itemAdapterEmpty),\r\n    lastVisible: itemAdapterEmpty,\r\n    lastVisible$: new BehaviorSubject<ItemAdapter>(itemAdapterEmpty),\r\n    itemsCount: 0,\r\n    initialize: () => null,\r\n    reload: () => null,\r\n    showLog: () => null,\r\n    setMinIndex: () => null,\r\n    setScrollPosition: () => null\r\n  }\r\n);\r\n\r\nexport class Adapter implements IAdapter {\r\n\r\n  get init(): boolean {\r\n    return this.isInitialized;\r\n  }\r\n\r\n  get init$(): Observable<boolean> {\r\n    return getIsInitialized(this);\r\n  }\r\n\r\n  get version(): string | null {\r\n    return this.isInitialized ? this.getVersion() : null;\r\n  }\r\n\r\n  get isLoading(): boolean {\r\n    return this.isInitialized ? this.getIsLoading() : false;\r\n  }\r\n\r\n  get isLoading$(): BehaviorSubject<boolean> {\r\n    return getInitializedSubject(this, () => this.getIsLoading$());\r\n  }\r\n\r\n  get loopPending(): boolean {\r\n    return this.isInitialized ? this.getLoopPending() : false;\r\n  }\r\n\r\n  get loopPending$(): BehaviorSubject<boolean> {\r\n    return getInitializedSubject(this, () => this.getLoopPending$());\r\n  }\r\n\r\n  get cyclePending(): boolean {\r\n    return this.isInitialized ? this.getCyclePending() : false;\r\n  }\r\n\r\n  get cyclePending$(): BehaviorSubject<boolean> {\r\n    return getInitializedSubject(this, () => this.getCyclePending$());\r\n  }\r\n\r\n  get firstVisible(): ItemAdapter {\r\n    return this.isInitialized ? this.getFirstVisible() : {};\r\n  }\r\n\r\n  get firstVisible$(): BehaviorSubject<ItemAdapter> {\r\n    return getInitializedSubject(this, () => this.getFirstVisible$());\r\n  }\r\n\r\n  get lastVisible(): ItemAdapter {\r\n    return this.isInitialized ? this.getLastVisible() : {};\r\n  }\r\n\r\n  get lastVisible$(): BehaviorSubject<ItemAdapter> {\r\n    return getInitializedSubject(this, () => this.getLastVisible$());\r\n  }\r\n\r\n  get itemsCount(): number {\r\n    return this.isInitialized ? this.getItemsCount() : 0;\r\n  }\r\n\r\n  private scroller: Scroller;\r\n  private isInitialized: boolean;\r\n  private callWorkflow: Function;\r\n  private getVersion: Function;\r\n  private getIsLoading: Function;\r\n  private getIsLoading$: Function;\r\n  private getCyclePending: Function;\r\n  private getCyclePending$: Function;\r\n  private getLoopPending: Function;\r\n  private getLoopPending$: Function;\r\n  private getItemsCount: Function;\r\n  private getFirstVisible: Function;\r\n  private getFirstVisible$: Function;\r\n  private getLastVisible: Function;\r\n  private getLastVisible$: Function;\r\n\r\n  constructor() {\r\n    this.isInitialized = false;\r\n  }\r\n\r\n  initialize(scroller: Scroller) {\r\n    if (this.isInitialized) {\r\n      return;\r\n    }\r\n    this.scroller = scroller;\r\n    const { state, buffer } = scroller;\r\n    this.isInitialized = true;\r\n    this.callWorkflow = scroller.callWorkflow;\r\n    this.getVersion = (): string | null => scroller.version;\r\n    this.getIsLoading = (): boolean => state.isLoading;\r\n    this.getIsLoading$ = (): BehaviorSubject<boolean> => state.isLoadingSource;\r\n    this.getLoopPending = (): boolean => state.loopPending;\r\n    this.getLoopPending$ = (): BehaviorSubject<boolean> => state.loopPendingSource;\r\n    this.getCyclePending = (): boolean => state.workflowPending;\r\n    this.getCyclePending$ = (): BehaviorSubject<boolean> => state.workflowPendingSource;\r\n    this.getItemsCount = (): number => buffer.getVisibleItemsCount();\r\n    this.initializeProtected(scroller);\r\n  }\r\n\r\n  initializeProtected(scroller: Scroller) {\r\n    const { state } = scroller;\r\n    let getFirstVisibleProtected = () => {\r\n      getFirstVisibleProtected = () => state.firstVisibleItem;\r\n      state.firstVisibleWanted = true;\r\n      return state.firstVisibleItem;\r\n    };\r\n    let getFirstVisible$Protected = () => {\r\n      getFirstVisible$Protected = () => state.firstVisibleSource;\r\n      state.firstVisibleWanted = true;\r\n      return state.firstVisibleSource;\r\n    };\r\n    let getLastVisibleProtected = () => {\r\n      getLastVisibleProtected = () => state.lastVisibleItem;\r\n      state.lastVisibleWanted = true;\r\n      return state.lastVisibleItem;\r\n    };\r\n    let getLastVisible$Protected = () => {\r\n      getLastVisible$Protected = () => state.lastVisibleSource;\r\n      state.lastVisibleWanted = true;\r\n      return state.lastVisibleSource;\r\n    };\r\n    this.getFirstVisible = (): ItemAdapter => getFirstVisibleProtected();\r\n    this.getFirstVisible$ = (): BehaviorSubject<ItemAdapter> => getFirstVisible$Protected();\r\n    this.getLastVisible = (): ItemAdapter => getLastVisibleProtected();\r\n    this.getLastVisible$ = (): BehaviorSubject<ItemAdapter> => getLastVisible$Protected();\r\n  }\r\n\r\n  reload(reloadIndex?: number | string) {\r\n    this.scroller.logger.log(() => `adapter: reload(${reloadIndex})`);\r\n    this.callWorkflow(<ProcessSubject>{\r\n      process: Process.reload,\r\n      status: ProcessStatus.start,\r\n      payload: reloadIndex\r\n    });\r\n  }\r\n\r\n  showLog() {\r\n    this.scroller.logger.logForce();\r\n  }\r\n\r\n  setScrollPosition(value: number) {\r\n    this.scroller.logger.log(() => `adapter: setScrollPosition(${value})`);\r\n    const position = Number(value);\r\n    const parsedValue = parseInt(<any>value, 10);\r\n    if (position !== parsedValue) {\r\n      this.scroller.logger.log(() =>\r\n        `can't set scroll position because ${value} is not an integer`);\r\n    } else {\r\n      this.scroller.state.syntheticScroll.reset();\r\n      this.scroller.viewport.setPosition(value);\r\n    }\r\n  }\r\n\r\n  setMinIndex(value: number) {\r\n    this.scroller.logger.log(() => `adapter: setMinIndex(${value})`);\r\n    const index = Number(value);\r\n    if (isNaN(index)) {\r\n      this.scroller.logger.log(() =>\r\n        `can't set minIndex because ${value} is not a number`);\r\n    } else {\r\n      this.scroller.buffer.minIndexUser = index;\r\n    }\r\n  }\r\n}\r\n"]}