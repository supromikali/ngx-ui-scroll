{"version":3,"file":"scroller.js","sourceRoot":"","sources":["../../../src/component/scroller.ts"],"names":[],"mappings":"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","sourcesContent":["import { Observable, Subscription, Observer } from 'rxjs';\n\nimport { UiScrollComponent } from '../ui-scroll.component';\nimport { checkDatasource } from './utils/index';\nimport { Datasource } from './classes/datasource';\nimport { Settings } from './classes/settings';\nimport { Logger } from './classes/logger';\nimport { Routines } from './classes/domRoutines';\nimport { Viewport } from './classes/viewport';\nimport { Buffer } from './classes/buffer';\nimport { State } from './classes/state';\nimport { CallWorkflow } from './interfaces/index';\n\nlet instanceCount = 0;\n\nexport class Scroller {\n\n  readonly runChangeDetector: Function;\n  readonly callWorkflow: CallWorkflow;\n\n  public version: string;\n  public datasource: Datasource;\n  public settings: Settings;\n  public logger: Logger;\n  public routines: Routines;\n  public viewport: Viewport;\n  public buffer: Buffer;\n  public state: State;\n\n  public innerLoopSubscriptions: Array<Subscription>;\n\n  constructor(context: UiScrollComponent, callWorkflow: CallWorkflow) {\n    const datasource = <Datasource>checkDatasource(context.datasource);\n    this.datasource = datasource;\n    this.version = context.version;\n\n    this.runChangeDetector = () => context.changeDetector.markForCheck();\n    // this.runChangeDetector = () => context.changeDetector.detectChanges();\n    this.callWorkflow = callWorkflow;\n    this.innerLoopSubscriptions = [];\n\n    this.settings = new Settings(datasource.settings, datasource.devSettings, ++instanceCount);\n    this.logger = new Logger(this);\n    this.routines = new Routines(this.settings);\n    this.state = new State(this.settings, this.logger);\n    this.buffer = new Buffer(this.settings, this.state.startIndex, this.logger);\n    this.viewport = new Viewport(context.elementRef, this.settings, this.routines, this.state, this.logger);\n\n    this.logger.object('uiScroll settings object', this.settings, true);\n\n    if (!datasource.constructed) {\n      this.datasource = new Datasource(datasource, !this.settings.adapter);\n      if (this.settings.adapter) {\n        this.datasource.adapter.initialize(this);\n      }\n    } else {\n      this.datasource.adapter.initialize(this);\n    }\n  }\n\n  init() {\n    this.viewport.reset(0);\n  }\n\n  bindData(): Observable<any> {\n    this.runChangeDetector();\n    return Observable.create((observer: Observer<any>) => {\n        setTimeout(() => {\n          observer.next(true);\n          observer.complete();\n        });\n      }\n    );\n  }\n\n  purgeInnerLoopSubscriptions() {\n    this.innerLoopSubscriptions.forEach((item: Subscription) => item.unsubscribe());\n    this.innerLoopSubscriptions = [];\n  }\n\n  purgeScrollTimers(localOnly?: boolean) {\n    const { state: { scrollState } } = this;\n    if (scrollState.scrollTimer) {\n      clearTimeout(scrollState.scrollTimer);\n      scrollState.scrollTimer = null;\n    }\n    if (!localOnly && scrollState.workflowTimer) {\n      clearTimeout(scrollState.workflowTimer);\n      scrollState.workflowTimer = null;\n    }\n  }\n\n  dispose() {\n    this.purgeInnerLoopSubscriptions();\n    this.purgeScrollTimers();\n  }\n\n  finalize() {\n  }\n\n}\n"]}