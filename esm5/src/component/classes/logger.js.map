{"version":3,"file":"logger.js","sourceRoot":"","sources":["../../../../src/component/classes/logger.ts"],"names":[],"mappings":"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","sourcesContent":["import { Scroller } from '../scroller';\nimport { Process, ProcessRun, ProcessStatus as Status, ProcessSubject } from '../interfaces/index';\n\nexport class Logger {\n\n  readonly debug: boolean;\n  readonly immediateLog: boolean;\n  readonly logTime: boolean;\n  readonly getTime: Function;\n  readonly getStat: Function;\n  readonly getFetchRange: Function;\n  readonly getInnerLoopCount: Function;\n  readonly getWorkflowCycleData: Function;\n  private logs: Array<any> = [];\n\n  constructor(scroller: Scroller) {\n    const { settings } = scroller;\n    this.debug = settings.debug;\n    this.immediateLog = settings.immediateLog;\n    this.logTime = settings.logTime;\n    this.getTime = (): string =>\n      scroller.state && ` // time: ${scroller.state.time}`;\n    this.getStat = (): string => {\n      const { buffer, viewport } = scroller;\n      const first = buffer.getFirstVisibleItem();\n      const last = buffer.getLastVisibleItem();\n      return 'pos: ' + viewport.scrollPosition + ', ' +\n        'size: ' + viewport.getScrollableSize() + ', ' +\n        'bwd_p: ' + viewport.paddings.backward.size + ', ' +\n        'fwd_p: ' + viewport.paddings.forward.size + ', ' +\n        'aver: ' + (buffer.hasItemSize ? buffer.averageSize : 'no') + ', ' +\n        'items: ' + buffer.getVisibleItemsCount() + ', ' +\n        'range: ' + (first && last ? `[${first.$index}..${last.$index}]` : 'no');\n    };\n    this.getFetchRange = (): string => {\n      const { firstIndex, lastIndex } = scroller.state.fetch;\n      const hasInterval = firstIndex !== null && lastIndex !== null && !isNaN(firstIndex) && !isNaN(lastIndex);\n      return hasInterval ? `[${firstIndex}..${lastIndex}]` : 'no';\n    };\n    this.getInnerLoopCount = (): number => scroller.state.innerLoopCount;\n    this.getWorkflowCycleData = (more: boolean): string =>\n      `${scroller.settings.instanceIndex}-${scroller.state.workflowCycleCount}` + (more ? '-' : '');\n    this.log(() => `uiScroll Workflow has been started (v${scroller.version}, instance ${settings.instanceIndex})`);\n  }\n\n  object(str: string, obj: any, stringify?: boolean) {\n    this.log(() => [\n      str,\n      stringify\n        ? JSON.stringify(obj)\n          .replace(/\"/g, '')\n          .replace(/(\\{|\\:|\\,)/g, '$1 ')\n        : obj\n    ]);\n  }\n\n  stat(str?: string) {\n    if (this.debug) {\n      const logStyles = ['color: #888; border: dashed #888 0; border-bottom-width: 0px', 'color: #000; border-width: 0'];\n      this.log(() => ['%cstat' + (str ? ` ${str}` : '') + ',%c ' + this.getStat(), ...logStyles]);\n    }\n  }\n\n  fetch(str?: string) {\n    if (this.debug) {\n      const _text = 'fetch interval' + (str ? ` ${str}` : '');\n      const logStyles = ['color: #888', 'color: #000'];\n      this.log(() => [`%c${_text}: %c${this.getFetchRange()}`, ...logStyles]);\n    }\n  }\n\n  logProcess(data: ProcessSubject) {\n    if (!this.debug) {\n      return;\n    }\n    const { process, status } = data;\n    const payload: ProcessRun = data.payload || { empty: true };\n\n    // standard process log\n    const processLog = `process ${process}, %c${status}%c` + (!payload.empty ? ',' : '');\n    const styles = [status === Status.error ? 'color: #cc0000;' : '', 'color: #000000;'];\n    this.log(() => [processLog, ...styles, ...(!payload.empty ? [payload] : [])]);\n\n    // inner loop start-end log\n    const workflowCycleData = this.getWorkflowCycleData(true);\n    const loopCount = this.getInnerLoopCount();\n    const loopLog: string[] = [];\n    if (\n      process === Process.init && status === Status.next ||\n      process === Process.scroll && status === Status.next && payload.keepScroll ||\n      process === Process.end && status === Status.next && payload.byTimer\n    ) {\n      loopLog.push(`%c---=== loop ${workflowCycleData + (loopCount + 1)} start`);\n    } else if (\n      process === Process.end && !payload.byTimer\n    ) {\n      loopLog.push(`%c---=== loop ${workflowCycleData + loopCount} done`);\n      if (status === Status.next && !(payload.keepScroll)) {\n        loopLog[0] += `, loop ${workflowCycleData + (loopCount + 1)} start`;\n      }\n    }\n    if (loopLog.length) {\n      this.log(() => [...loopLog, 'color: #006600;']);\n    }\n\n    // workflow cycle start log\n    if (\n      process === Process.init && status === Status.start ||\n      process === Process.reload && status === Status.next ||\n      process === Process.scroll && status === Status.next && !(payload.keepScroll)\n    ) {\n      const logData = this.getWorkflowCycleData(false);\n      const logStyles = 'color: #0000aa; border: solid black 1px; border-width: 1px 0 0 1px; margin-left: -2px';\n      this.log(() => [`%c   ~~~ WF Cycle ${logData} STARTED ~~~  `, logStyles]);\n    }\n\n    // workflow run end log\n    if (process === Process.end && status === Status.done) {\n      const logData = this.getWorkflowCycleData(false);\n      const logStyles = 'color: #0000aa; border: solid #555 1px; border-width: 0 0 1px 1px; margin-left: -2px';\n      this.log(() => [`%c   ~~~ WF Cycle ${logData} FINALIZED ~~~  `, logStyles]);\n    }\n  }\n\n  log(...args: Array<any>) {\n    if (this.debug) {\n      if (typeof args[0] === 'function') {\n        args = args[0]();\n        if (!Array.isArray(args)) {\n          args = [args];\n        }\n      }\n      if (args.every(item => item === undefined)) {\n        return;\n      }\n      if (this.logTime) {\n        args = [...args, this.getTime()];\n      }\n      if (this.immediateLog) {\n        console.log.apply(this, args);\n      } else {\n        this.logs.push(args);\n      }\n    }\n  }\n\n  logForce(...args: Array<any>) {\n    if (this.debug) {\n      if (!this.immediateLog && this.logs.length) {\n        this.logs.forEach(logArgs => console.log.apply(this, logArgs));\n        this.logs = [];\n      }\n      if (args.length) {\n        console.log.apply(this, args);\n      }\n    }\n  }\n}\n"]}