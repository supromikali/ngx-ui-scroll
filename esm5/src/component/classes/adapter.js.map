{"version":3,"file":"adapter.js","sourceRoot":"","sources":["../../../../src/component/classes/adapter.ts"],"names":[],"mappings":";;;;AAAA,OAAO,EAAE,eAAe,EAAE,UAAU,EAAY,EAAE,IAAI,YAAY,EAAE,MAAM,MAAM,CAAC;AACjF,OAAO,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;AAE3C,OAAO,EAAuB,OAAO,EAAkB,aAAa,EAAe,MAAM,qBAAqB,CAAC;;IAGzG,gBAAgB,GAAG,UAAC,OAAgB;IACxC,OAAA,UAAU,CAAC,MAAM,CAAC,UAAC,QAA2B;;YACtC,UAAU,GAAG,WAAW,CAAC;YAC7B,IAAI,OAAO,IAAI,OAAO,CAAC,IAAI,EAAE;gBAC3B,aAAa,CAAC,UAAU,CAAC,CAAC;gBAC1B,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACpB,QAAQ,CAAC,QAAQ,EAAE,CAAC;aACrB;QACH,CAAC,EAAE,EAAE,CAAC;IACR,CAAC,CAAC;AARF,CAQE;;;IAEE,qBAAqB,GAAG,UAAC,OAAgB,EAAE,MAAgB;IAC/D,OAAO,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,MAAM,EAAE,CAAC,CAAC;QAC9B,OAAO,CAAC,KAAK;aACV,IAAI,CAAC,SAAS,CAAC;YACd,OAAA,MAAM,EAAE;QAAR,CAAQ,CACT,CAAC,CAAC;AACT,CAAC;;;AAED,MAAM,KAAO,gBAAgB,GAAG,mBAAc;IAC5C,IAAI,EAAE,EAAE;IACR,OAAO,EAAE,EAAE;CACZ,EAAA;;AAED,MAAM,KAAO,mBAAmB,GAAG,cAAgB,OAAA,CACjD,mBAAW;IACT,OAAO,EAAE,IAAI;IACb,IAAI,EAAE,KAAK;IACX,KAAK,EAAE,YAAY,CAAC,KAAK,CAAC;IAC1B,SAAS,EAAE,KAAK;IAChB,UAAU,EAAE,IAAI,eAAe,CAAU,KAAK,CAAC;IAC/C,YAAY,EAAE,KAAK;IACnB,aAAa,EAAE,IAAI,eAAe,CAAU,KAAK,CAAC;IAClD,WAAW,EAAE,KAAK;IAClB,YAAY,EAAE,IAAI,eAAe,CAAU,KAAK,CAAC;IACjD,YAAY,EAAE,gBAAgB;IAC9B,aAAa,EAAE,IAAI,eAAe,CAAc,gBAAgB,CAAC;IACjE,WAAW,EAAE,gBAAgB;IAC7B,YAAY,EAAE,IAAI,eAAe,CAAc,gBAAgB,CAAC;IAChE,UAAU,EAAE,CAAC;IACb,UAAU,EAAE,cAAM,OAAA,IAAI,EAAJ,CAAI;IACtB,MAAM,EAAE,cAAM,OAAA,IAAI,EAAJ,CAAI;IAClB,OAAO,EAAE,cAAM,OAAA,IAAI,EAAJ,CAAI;IACnB,WAAW,EAAE,cAAM,OAAA,IAAI,EAAJ,CAAI;IACvB,iBAAiB,EAAE,cAAM,OAAA,IAAI,EAAJ,CAAI;CAC9B,EAAA,CACF,EAtBkD,CAsBlD;AAED;IA0EE;QACE,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;IAC7B,CAAC;IA1ED,sBAAI,yBAAI;;;;QAAR;YACE,OAAO,IAAI,CAAC,aAAa,CAAC;QAC5B,CAAC;;;OAAA;IAED,sBAAI,0BAAK;;;;QAAT;YACE,OAAO,gBAAgB,CAAC,IAAI,CAAC,CAAC;QAChC,CAAC;;;OAAA;IAED,sBAAI,4BAAO;;;;QAAX;YACE,OAAO,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC;QACvD,CAAC;;;OAAA;IAED,sBAAI,8BAAS;;;;QAAb;YACE,OAAO,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;QAC1D,CAAC;;;OAAA;IAED,sBAAI,+BAAU;;;;QAAd;YAAA,iBAEC;YADC,OAAO,qBAAqB,CAAC,IAAI,EAAE,cAAM,OAAA,KAAI,CAAC,aAAa,EAAE,EAApB,CAAoB,CAAC,CAAC;QACjE,CAAC;;;OAAA;IAED,sBAAI,gCAAW;;;;QAAf;YACE,OAAO,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;QAC5D,CAAC;;;OAAA;IAED,sBAAI,iCAAY;;;;QAAhB;YAAA,iBAEC;YADC,OAAO,qBAAqB,CAAC,IAAI,EAAE,cAAM,OAAA,KAAI,CAAC,eAAe,EAAE,EAAtB,CAAsB,CAAC,CAAC;QACnE,CAAC;;;OAAA;IAED,sBAAI,iCAAY;;;;QAAhB;YACE,OAAO,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;QAC7D,CAAC;;;OAAA;IAED,sBAAI,kCAAa;;;;QAAjB;YAAA,iBAEC;YADC,OAAO,qBAAqB,CAAC,IAAI,EAAE,cAAM,OAAA,KAAI,CAAC,gBAAgB,EAAE,EAAvB,CAAuB,CAAC,CAAC;QACpE,CAAC;;;OAAA;IAED,sBAAI,iCAAY;;;;QAAhB;YACE,OAAO,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;QAC1D,CAAC;;;OAAA;IAED,sBAAI,kCAAa;;;;QAAjB;YAAA,iBAEC;YADC,OAAO,qBAAqB,CAAC,IAAI,EAAE,cAAM,OAAA,KAAI,CAAC,gBAAgB,EAAE,EAAvB,CAAuB,CAAC,CAAC;QACpE,CAAC;;;OAAA;IAED,sBAAI,gCAAW;;;;QAAf;YACE,OAAO,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;QACzD,CAAC;;;OAAA;IAED,sBAAI,iCAAY;;;;QAAhB;YAAA,iBAEC;YADC,OAAO,qBAAqB,CAAC,IAAI,EAAE,cAAM,OAAA,KAAI,CAAC,eAAe,EAAE,EAAtB,CAAsB,CAAC,CAAC;QACnE,CAAC;;;OAAA;IAED,sBAAI,+BAAU;;;;QAAd;YACE,OAAO,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QACvD,CAAC;;;OAAA;;;;;IAsBD,4BAAU;;;;IAAV,UAAW,QAAkB;QAC3B,IAAI,IAAI,CAAC,aAAa,EAAE;YACtB,OAAO;SACR;QACD,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACjB,IAAA,sBAAK,EAAE,wBAAM;QACrB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,YAAY,GAAG,QAAQ,CAAC,YAAY,CAAC;QAC1C,IAAI,CAAC,UAAU,GAAG,cAAqB,OAAA,QAAQ,CAAC,OAAO,EAAhB,CAAgB,CAAC;QACxD,IAAI,CAAC,YAAY,GAAG,cAAe,OAAA,KAAK,CAAC,SAAS,EAAf,CAAe,CAAC;QACnD,IAAI,CAAC,aAAa,GAAG,cAAgC,OAAA,KAAK,CAAC,eAAe,EAArB,CAAqB,CAAC;QAC3E,IAAI,CAAC,cAAc,GAAG,cAAe,OAAA,KAAK,CAAC,WAAW,EAAjB,CAAiB,CAAC;QACvD,IAAI,CAAC,eAAe,GAAG,cAAgC,OAAA,KAAK,CAAC,iBAAiB,EAAvB,CAAuB,CAAC;QAC/E,IAAI,CAAC,eAAe,GAAG,cAAe,OAAA,KAAK,CAAC,eAAe,EAArB,CAAqB,CAAC;QAC5D,IAAI,CAAC,gBAAgB,GAAG,cAAgC,OAAA,KAAK,CAAC,qBAAqB,EAA3B,CAA2B,CAAC;QACpF,IAAI,CAAC,aAAa,GAAG,cAAc,OAAA,MAAM,CAAC,oBAAoB,EAAE,EAA7B,CAA6B,CAAC;QACjE,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC;IACrC,CAAC;;;;;IAED,qCAAmB;;;;IAAnB,UAAoB,QAAkB;QAC5B,IAAA,sBAAK;;YACT,wBAAwB,GAAG;YAC7B,wBAAwB,GAAG,cAAM,OAAA,KAAK,CAAC,gBAAgB,EAAtB,CAAsB,CAAC;YACxD,KAAK,CAAC,kBAAkB,GAAG,IAAI,CAAC;YAChC,OAAO,KAAK,CAAC,gBAAgB,CAAC;QAChC,CAAC;;YACG,yBAAyB,GAAG;YAC9B,yBAAyB,GAAG,cAAM,OAAA,KAAK,CAAC,kBAAkB,EAAxB,CAAwB,CAAC;YAC3D,KAAK,CAAC,kBAAkB,GAAG,IAAI,CAAC;YAChC,OAAO,KAAK,CAAC,kBAAkB,CAAC;QAClC,CAAC;;YACG,uBAAuB,GAAG;YAC5B,uBAAuB,GAAG,cAAM,OAAA,KAAK,CAAC,eAAe,EAArB,CAAqB,CAAC;YACtD,KAAK,CAAC,iBAAiB,GAAG,IAAI,CAAC;YAC/B,OAAO,KAAK,CAAC,eAAe,CAAC;QAC/B,CAAC;;YACG,wBAAwB,GAAG;YAC7B,wBAAwB,GAAG,cAAM,OAAA,KAAK,CAAC,iBAAiB,EAAvB,CAAuB,CAAC;YACzD,KAAK,CAAC,iBAAiB,GAAG,IAAI,CAAC;YAC/B,OAAO,KAAK,CAAC,iBAAiB,CAAC;QACjC,CAAC;QACD,IAAI,CAAC,eAAe,GAAG,cAAmB,OAAA,wBAAwB,EAAE,EAA1B,CAA0B,CAAC;QACrE,IAAI,CAAC,gBAAgB,GAAG,cAAoC,OAAA,yBAAyB,EAAE,EAA3B,CAA2B,CAAC;QACxF,IAAI,CAAC,cAAc,GAAG,cAAmB,OAAA,uBAAuB,EAAE,EAAzB,CAAyB,CAAC;QACnE,IAAI,CAAC,eAAe,GAAG,cAAoC,OAAA,wBAAwB,EAAE,EAA1B,CAA0B,CAAC;IACxF,CAAC;;;;;IAED,wBAAM;;;;IAAN,UAAO,WAA6B;QAClC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,cAAM,OAAA,qBAAmB,WAAW,MAAG,EAAjC,CAAiC,CAAC,CAAC;QAClE,IAAI,CAAC,YAAY,CAAC,mBAAgB;YAChC,OAAO,EAAE,OAAO,CAAC,MAAM;YACvB,MAAM,EAAE,aAAa,CAAC,KAAK;YAC3B,OAAO,EAAE,WAAW;SACrB,EAAA,CAAC,CAAC;IACL,CAAC;;;;IAED,yBAAO;;;IAAP;QACE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;IAClC,CAAC;;;;;IAED,mCAAiB;;;;IAAjB,UAAkB,KAAa;QAC7B,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,cAAM,OAAA,gCAA8B,KAAK,MAAG,EAAtC,CAAsC,CAAC,CAAC;;YACjE,QAAQ,GAAG,MAAM,CAAC,KAAK,CAAC;;YACxB,WAAW,GAAG,QAAQ,CAAC,mBAAK,KAAK,EAAA,EAAE,EAAE,CAAC;QAC5C,IAAI,QAAQ,KAAK,WAAW,EAAE;YAC5B,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC;gBACvB,OAAA,uCAAqC,KAAK,uBAAoB;YAA9D,CAA8D,CAAC,CAAC;SACnE;aAAM;YACL,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;YAC5C,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;SAC3C;IACH,CAAC;;;;;IAED,6BAAW;;;;IAAX,UAAY,KAAa;QACvB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,cAAM,OAAA,0BAAwB,KAAK,MAAG,EAAhC,CAAgC,CAAC,CAAC;;YAC3D,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;QAC3B,IAAI,KAAK,CAAC,KAAK,CAAC,EAAE;YAChB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC;gBACvB,OAAA,gCAA8B,KAAK,qBAAkB;YAArD,CAAqD,CAAC,CAAC;SAC1D;aAAM;YACL,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,GAAG,KAAK,CAAC;SAC3C;IACH,CAAC;IACH,cAAC;AAAD,CAAC,AAjKD,IAiKC;;;;IAvGC,2BAA2B;;IAC3B,gCAA+B;;IAC/B,+BAA+B;;IAC/B,6BAA6B;;IAC7B,+BAA+B;;IAC/B,gCAAgC;;IAChC,kCAAkC;;IAClC,mCAAmC;;IACnC,iCAAiC;;IACjC,kCAAkC;;IAClC,gCAAgC;;IAChC,kCAAkC;;IAClC,mCAAmC;;IACnC,iCAAiC;;IACjC,kCAAkC","sourcesContent":["import { BehaviorSubject, Observable, Observer, of as observableOf } from 'rxjs';\r\nimport { switchMap } from 'rxjs/operators';\r\n\r\nimport { Adapter as IAdapter, Process, ProcessSubject, ProcessStatus, ItemAdapter } from '../interfaces/index';\r\nimport { Scroller } from '../scroller';\r\n\r\nconst getIsInitialized = (adapter: Adapter): Observable<boolean> =>\r\n  Observable.create((observer: Observer<boolean>) => {\r\n    const intervalId = setInterval(() => {\r\n      if (adapter && adapter.init) {\r\n        clearInterval(intervalId);\r\n        observer.next(true);\r\n        observer.complete();\r\n      }\r\n    }, 25);\r\n  });\r\n\r\nconst getInitializedSubject = (adapter: Adapter, method: Function): BehaviorSubject<any> => {\r\n  return adapter.init ? method() :\r\n    adapter.init$\r\n      .pipe(switchMap(() =>\r\n        method()\r\n      ));\r\n};\r\n\r\nexport const itemAdapterEmpty = <ItemAdapter> {\r\n  data: {},\r\n  element: {}\r\n};\r\n\r\nexport const generateMockAdapter = (): IAdapter => (\r\n  <IAdapter> {\r\n    version: null,\r\n    init: false,\r\n    init$: observableOf(false),\r\n    isLoading: false,\r\n    isLoading$: new BehaviorSubject<boolean>(false),\r\n    cyclePending: false,\r\n    cyclePending$: new BehaviorSubject<boolean>(false),\r\n    loopPending: false,\r\n    loopPending$: new BehaviorSubject<boolean>(false),\r\n    firstVisible: itemAdapterEmpty,\r\n    firstVisible$: new BehaviorSubject<ItemAdapter>(itemAdapterEmpty),\r\n    lastVisible: itemAdapterEmpty,\r\n    lastVisible$: new BehaviorSubject<ItemAdapter>(itemAdapterEmpty),\r\n    itemsCount: 0,\r\n    initialize: () => null,\r\n    reload: () => null,\r\n    showLog: () => null,\r\n    setMinIndex: () => null,\r\n    setScrollPosition: () => null\r\n  }\r\n);\r\n\r\nexport class Adapter implements IAdapter {\r\n\r\n  get init(): boolean {\r\n    return this.isInitialized;\r\n  }\r\n\r\n  get init$(): Observable<boolean> {\r\n    return getIsInitialized(this);\r\n  }\r\n\r\n  get version(): string | null {\r\n    return this.isInitialized ? this.getVersion() : null;\r\n  }\r\n\r\n  get isLoading(): boolean {\r\n    return this.isInitialized ? this.getIsLoading() : false;\r\n  }\r\n\r\n  get isLoading$(): BehaviorSubject<boolean> {\r\n    return getInitializedSubject(this, () => this.getIsLoading$());\r\n  }\r\n\r\n  get loopPending(): boolean {\r\n    return this.isInitialized ? this.getLoopPending() : false;\r\n  }\r\n\r\n  get loopPending$(): BehaviorSubject<boolean> {\r\n    return getInitializedSubject(this, () => this.getLoopPending$());\r\n  }\r\n\r\n  get cyclePending(): boolean {\r\n    return this.isInitialized ? this.getCyclePending() : false;\r\n  }\r\n\r\n  get cyclePending$(): BehaviorSubject<boolean> {\r\n    return getInitializedSubject(this, () => this.getCyclePending$());\r\n  }\r\n\r\n  get firstVisible(): ItemAdapter {\r\n    return this.isInitialized ? this.getFirstVisible() : {};\r\n  }\r\n\r\n  get firstVisible$(): BehaviorSubject<ItemAdapter> {\r\n    return getInitializedSubject(this, () => this.getFirstVisible$());\r\n  }\r\n\r\n  get lastVisible(): ItemAdapter {\r\n    return this.isInitialized ? this.getLastVisible() : {};\r\n  }\r\n\r\n  get lastVisible$(): BehaviorSubject<ItemAdapter> {\r\n    return getInitializedSubject(this, () => this.getLastVisible$());\r\n  }\r\n\r\n  get itemsCount(): number {\r\n    return this.isInitialized ? this.getItemsCount() : 0;\r\n  }\r\n\r\n  private scroller: Scroller;\r\n  private isInitialized: boolean;\r\n  private callWorkflow: Function;\r\n  private getVersion: Function;\r\n  private getIsLoading: Function;\r\n  private getIsLoading$: Function;\r\n  private getCyclePending: Function;\r\n  private getCyclePending$: Function;\r\n  private getLoopPending: Function;\r\n  private getLoopPending$: Function;\r\n  private getItemsCount: Function;\r\n  private getFirstVisible: Function;\r\n  private getFirstVisible$: Function;\r\n  private getLastVisible: Function;\r\n  private getLastVisible$: Function;\r\n\r\n  constructor() {\r\n    this.isInitialized = false;\r\n  }\r\n\r\n  initialize(scroller: Scroller) {\r\n    if (this.isInitialized) {\r\n      return;\r\n    }\r\n    this.scroller = scroller;\r\n    const { state, buffer } = scroller;\r\n    this.isInitialized = true;\r\n    this.callWorkflow = scroller.callWorkflow;\r\n    this.getVersion = (): string | null => scroller.version;\r\n    this.getIsLoading = (): boolean => state.isLoading;\r\n    this.getIsLoading$ = (): BehaviorSubject<boolean> => state.isLoadingSource;\r\n    this.getLoopPending = (): boolean => state.loopPending;\r\n    this.getLoopPending$ = (): BehaviorSubject<boolean> => state.loopPendingSource;\r\n    this.getCyclePending = (): boolean => state.workflowPending;\r\n    this.getCyclePending$ = (): BehaviorSubject<boolean> => state.workflowPendingSource;\r\n    this.getItemsCount = (): number => buffer.getVisibleItemsCount();\r\n    this.initializeProtected(scroller);\r\n  }\r\n\r\n  initializeProtected(scroller: Scroller) {\r\n    const { state } = scroller;\r\n    let getFirstVisibleProtected = () => {\r\n      getFirstVisibleProtected = () => state.firstVisibleItem;\r\n      state.firstVisibleWanted = true;\r\n      return state.firstVisibleItem;\r\n    };\r\n    let getFirstVisible$Protected = () => {\r\n      getFirstVisible$Protected = () => state.firstVisibleSource;\r\n      state.firstVisibleWanted = true;\r\n      return state.firstVisibleSource;\r\n    };\r\n    let getLastVisibleProtected = () => {\r\n      getLastVisibleProtected = () => state.lastVisibleItem;\r\n      state.lastVisibleWanted = true;\r\n      return state.lastVisibleItem;\r\n    };\r\n    let getLastVisible$Protected = () => {\r\n      getLastVisible$Protected = () => state.lastVisibleSource;\r\n      state.lastVisibleWanted = true;\r\n      return state.lastVisibleSource;\r\n    };\r\n    this.getFirstVisible = (): ItemAdapter => getFirstVisibleProtected();\r\n    this.getFirstVisible$ = (): BehaviorSubject<ItemAdapter> => getFirstVisible$Protected();\r\n    this.getLastVisible = (): ItemAdapter => getLastVisibleProtected();\r\n    this.getLastVisible$ = (): BehaviorSubject<ItemAdapter> => getLastVisible$Protected();\r\n  }\r\n\r\n  reload(reloadIndex?: number | string) {\r\n    this.scroller.logger.log(() => `adapter: reload(${reloadIndex})`);\r\n    this.callWorkflow(<ProcessSubject>{\r\n      process: Process.reload,\r\n      status: ProcessStatus.start,\r\n      payload: reloadIndex\r\n    });\r\n  }\r\n\r\n  showLog() {\r\n    this.scroller.logger.logForce();\r\n  }\r\n\r\n  setScrollPosition(value: number) {\r\n    this.scroller.logger.log(() => `adapter: setScrollPosition(${value})`);\r\n    const position = Number(value);\r\n    const parsedValue = parseInt(<any>value, 10);\r\n    if (position !== parsedValue) {\r\n      this.scroller.logger.log(() =>\r\n        `can't set scroll position because ${value} is not an integer`);\r\n    } else {\r\n      this.scroller.state.syntheticScroll.reset();\r\n      this.scroller.viewport.setPosition(value);\r\n    }\r\n  }\r\n\r\n  setMinIndex(value: number) {\r\n    this.scroller.logger.log(() => `adapter: setMinIndex(${value})`);\r\n    const index = Number(value);\r\n    if (isNaN(index)) {\r\n      this.scroller.logger.log(() =>\r\n        `can't set minIndex because ${value} is not a number`);\r\n    } else {\r\n      this.scroller.buffer.minIndexUser = index;\r\n    }\r\n  }\r\n}\r\n"]}